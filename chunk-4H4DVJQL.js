import{$ as pt,A as D,B as lt,F as G,G as M,Ga as q,H as P,Ha as F,I as st,J as z,Ja as nt,K as I,L as B,M as x,N as a,O as s,P as v,Pa as A,Q as Z,R as Y,S as H,T as b,V as _,W as K,X as p,_ as ct,b as at,ca as T,da as dt,ea as u,fa as y,ga as E,ha as L,i as S,ia as O,jb as xt,k as g,ka as mt,kb as vt,l as h,la as _t,lb as j,m as $,ma as d,mb as ft,na as m,nb as Ot,pb as yt,q as N,qa as k,ra as V,rb as R,sa as ut,sb as J,ta as gt,tb as U,ub as it,va as ht,vb as Q,wa as Ct,wb as Mt,x as et,y as r}from"./chunk-RJQEBGM5.js";var X=class{constructor(){this.levels=[],this.init(2,2,1)}init(c,t,n){let e=[];for(let o=0;o<n;o++){e[o]=[];for(let l=0;l<c;l++){e[o][l]=[];for(let C=0;C<t;C++)e[o][l][C]=0}}this.levels=e}clear(){let c=this.levels;for(let t of c)for(let n of t)for(let e=0;e<n.length;e++)n[e]=0}inBounds(c,t,n){let e=c>=0&&t>=0&&n>=0,o=c<this.levels.length&&t<this.levels[0].length&&n<this.levels[0][0].length;return e&&o}isTile(c,t,n){return this.levels[c][t][n]>0}isTilePosInvalid(c,t,n){let e=this.levels[c];if(!e[t+1]||e[t].length-1===n)return!0;let o=(C,f)=>{let w=e[t+C];return w&&w[n+f]||0};return[[0,1],[-1,1],[-1,-1],[1,0],[1,-1],[1,1]].some(([C,f])=>o(C,f)>0)}isTilePosBlocked(c,t,n){let e=this.levels[c];return e[t][n-1]>0?!0:e[t-1]?e[t-1][n]>0?!0:e[t-1][n-1]>0:!1}get(c,t,n){return this.levels[c][t][n]||0}setValue(c,t,n,e){this.levels[c][t][n]=e}applyMapping(c,t,n,e){let o=j(c,t,n,e);this.init(o.x+1,o.y+1,o.z);for(let l of c){let C=l[0],f=l[1],w=l[2];this.setValue(C,f,w,1)}}};function Pt(i){return bt([i])}function bt(i){return JSON.stringify(Vt(i))}function ot(i){let c=xt(it(Q(i.mapping)));return{id:vt(c),name:i.name,by:!i.by||i.by.length===0?void 0:i.by,cat:!i.category||i.category.length===0?void 0:i.category,map:it(c)}}function Vt(i){return{mah:"1.0",boards:i.map(t=>ot(t))}}function wt(i){let c=new X,t=j(i.mapping,0,0,0);c.init(t.x+1,t.y+1,t.z);for(let e of i.mapping){let o=e[0],l=e[1],C=e[2];c.setValue(o,l,C,1),c.setValue(o,l+1,C,2),c.setValue(o,l,C+1,4),c.setValue(o,l+1,C+1,3)}let n=["mahjongg-layout-v1.1",`# name: ${i.name}`,`# by: ${i.by}`,`# category: ${i.category}`,"# Board size in quarter tiles",`w${t.x+1}`,`h${t.y+1}`,"# Board depth",`d${t.z}`];for(let[e,o]of c.levels.entries()){let l=`# Level ${e} `;n.push(`${l}${"-".repeat(Math.max(t.x-l.length,0))}`);for(let C=0;C<=t.y;C++){let f=[];for(let w=0;w<=t.x;w++)f.push(o[w][C]||".");n.push(f.join(""))}}return n.join(`
`)}function Rt(i,c,t){let n=j(i,0,0,0),e=Math.max(0,Math.floor((t-n.y)/2)),o=Math.max(0,Math.floor((c-n.x)/2));return i.map(l=>[l[0],l[1]+o,l[2]+e])}function Zt(i){let c=new X,t=20,n=34,e=5,o=Rt(i,n,t);c.applyMapping(o,e,n,t);let l=[];for(let C=0;C<e;C++)for(let f=0;f<t;f++)for(let w=0;w<n;w++)l.push(c.get(C,w,f).toString());return l.join("")}function Et(i){let c=i.by?` by ${i.by}`:"",t=i.category?` :: ${i.category}`:"";return`Kyodai 6.0
${i.name}${c}${t}
${Zt(i.mapping)}
`}function Tt(i){rt("mah-layouts.mah",bt(i),"text/json")}function rt(i,c,t){let n=new Blob([c],{type:t}),e=document.createElement("a");e.href=window.URL.createObjectURL(n),e.download=i,e.click()}function Ft(i,c){if(i&1){let t=b();a(0,"div",0)(1,"div",6)(2,"label"),u(3),d(4,"translate"),s(),a(5,"input",7),_("input",function(e){g(t);let o=p();return h(o.layout().name=e.target.value)})("change",function(){g(t);let e=p();return h(e.update())})("blur",function(){g(t);let e=p();return h(e.update())}),s(),a(6,"label"),u(7),d(8,"translate"),s(),a(9,"input",7),_("input",function(e){g(t);let o=p();return h(o.layout().by=e.target.value)})("change",function(){g(t);let e=p();return h(e.update())})("blur",function(){g(t);let e=p();return h(e.update())}),s(),a(10,"label"),u(11),d(12,"translate"),s(),a(13,"input",7),_("input",function(e){g(t);let o=p();return h(o.layout().category=e.target.value)})("change",function(){g(t);let e=p();return h(e.update())})("blur",function(){g(t);let e=p();return h(e.update())}),s()(),a(14,"div",8),v(15,"app-layout-preview",9),s()()}if(i&2){let t=p();r(3),y(m(4,7,"EDITOR_LAYOUT_NAME")),r(2),x("value",t.layout().name),r(2),y(m(8,9,"EDITOR_LAYOUT_BY")),r(2),x("value",t.layout().by),r(2),y(m(12,11,"EDITOR_LAYOUT_CATEGORY")),r(2),x("value",t.layout().category),r(2),x("layout",t.layout())}}function Nt(i,c){if(i&1){let t=b();a(0,"li")(1,"input",10),_("change",function(){let e=g(t).$implicit,o=p();return h(o.chooseFormat(e))}),s(),a(2,"label",11),u(3),s()()}if(i&2){let t=c.$implicit,n=p();r(),x("id","format_"+t.name)("value",t)("checked",n.format===t),r(),x("for","format_"+t.name),r(),y(t.name)}}function Yt(i,c){if(i&1){let t=b();a(0,"button",4),_("click",function(){g(t);let e=p();return h(e.saveAsCopy())}),u(1),d(2,"translate"),s()}i&2&&(r(),y(m(2,1,"EDITOR_LAYOUT_SAVE_AS_COPY")))}var At=[{name:"Mah",ext:"mah",func:Pt,type:"text/json"},{name:"Kyodai",ext:"lay",func:Et,type:"text/lay"},{name:"Kmahjongg",ext:"layout",func:wt,type:"text/layout"}],kt=(()=>{class i{constructor(){this.layout=V.required(),this.savedEvent=k(),this.exportFormats=At,this.format=this.exportFormats[0],this.translate=S(q),this.layoutService=S(R)}ngOnInit(){this.layout()&&this.update()}ngOnChanges(t){t.layout&&this.update()}saveAsCopy(){this.layoutService.storeCustomBoards([this.exportLayout]);let t=this.layout();t.originalId=this.exportLayout.id,this.savedEvent.emit(!0)}save(){if(this.layoutService.layouts.items.some(e=>!e.custom&&e.id===this.exportLayout.id)){alert(this.translate.instant("EDITOR_BUILD_IN_EXISTS"));return}let t=[this.exportLayout.id],n=this.layout();n.originalId&&t.push(n.originalId),this.layoutService.removeCustomLayout(t),this.saveAsCopy()}chooseFormat(t){this.format=t,this.update()}download(){rt(this.filename,this.result,this.format.type),this.savedEvent.emit(!0)}update(){let t=this.layout();this.layoutName=t.name.toLocaleLowerCase().replace(/ /g,"_"),this.result=this.format.func(t),this.filename=`${this.layoutName}.${this.format.ext}`,this.exportLayout=ot(t)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-editor-export-component"]],inputs:{layout:[1,"layout"]},outputs:{savedEvent:"savedEvent"},features:[N],decls:24,vars:16,consts:[[1,"section"],[1,"export"],[1,"export-preview"],[1,"buttons"],[1,"text-button",3,"click"],[1,"text-button"],[1,"inputs"],["type","text",3,"input","change","blur","value"],[1,"preview"],[1,"svg-board",3,"layout"],["type","radio","name","format",3,"change","id","value","checked"],[3,"for"]],template:function(n,e){n&1&&(a(0,"h3"),u(1),d(2,"translate"),d(3,"translate"),s(),M(4,Ft,16,13,"div",0),a(5,"div",1)(6,"label"),u(7,"Format"),s(),a(8,"fieldset")(9,"ul"),I(10,Nt,4,5,"li",null,z),s()(),a(12,"div",2)(13,"pre"),u(14),s()(),v(15,"br"),a(16,"div",3)(17,"button",4),_("click",function(){return e.download()}),u(18),d(19,"translate"),s(),M(20,Yt,3,3,"button",5),a(21,"button",4),_("click",function(){return e.save()}),u(22),d(23,"translate"),s()()()),n&2&&(r(),L("",m(2,8,"EDITOR_SAVE")," / ",m(3,10,"EDITOR_EXPORT")),r(3),P(e.layout()?4:-1),r(6),B(e.exportFormats),r(4),y(e.result),r(4),L("",m(19,12,"EDITOR_LAYOUT_DOWNLOAD")," ",e.filename),r(2),P(e.layout()&&e.layout().originalId&&e.exportLayout.id!==e.layout().originalId?20:-1),r(2),y(m(23,14,"EDITOR_LAYOUT_SAVE")))},dependencies:[U,F],styles:["[_nghost-%COMP%]{color:var(--main-text-color)}[_nghost-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;padding-top:0;text-align:center}[_nghost-%COMP%]   .preview[_ngcontent-%COMP%]{max-height:180px;min-width:100px;padding-left:10px}[_nghost-%COMP%]   .inputs[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}[_nghost-%COMP%]   .inputs[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:4px;font-size:16px;margin-bottom:8px}@media only screen and (max-width:400px){[_nghost-%COMP%]   .preview[_ngcontent-%COMP%]{display:none}}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:flex}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{vertical-align:middle;cursor:pointer}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] + li[_ngcontent-%COMP%]{margin-left:10px}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   .export-preview[_ngcontent-%COMP%]{margin-top:16px}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   .export-preview[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{white-space:pre-line;overflow-wrap:break-word;font-family:monospace;text-align:left;overflow:auto;min-height:180px;max-height:180px;font-size:.8em;line-height:1em;background-color:#000}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 16px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{text-align:center;display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;background-color:#0000000d;background-image:none;border:1px solid var(--dialog-border-color);cursor:pointer;color:var(--main-text-color)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--main-text-color-hover);background-color:#0000001a;border:1px solid var(--dialog-border-color-hover)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button.text-button[_ngcontent-%COMP%]{padding:10px 16px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{color:var(--text-disabled-color);cursor:default}"]})}}return i})();function St(i,c){return this.gridID(c)}function Xt(i,c){if(i&1){let t=b();$(),Z(0,"rect",9),K("click",function(e){let o=g(t).$implicit,l=p();return h(l.onClickDraw(e,o))}),Y()}if(i&2){let t=c.$implicit;dt(t.className),G("x",t.pos.x)("y",t.pos.y)}}function $t(i,c){if(i&1){let t=b();$(),Z(0,"g",10),K("mousedown",function(e){let o=g(t).$implicit,l=p();return h(l.onClickStone(e,o))}),Z(1,"g",11),H(2,"rect",12)(3,"rect",13)(4,"use",14),Y()()}if(i&2){let t=c.$implicit;T("selected",t.source.selected)("hidden",t.source.picked)("hinted",t.source.hinted),G("transform",t.pos.translate)}}var Lt=(()=>{class i{constructor(){this.imageSet=V(),this.level=V(),this.matrix=V.required(),this.isBoard=V(),this.clickBoardEvent=k(),this.clickDrawEvent=k(),this.clickStoneEvent=k(),this.drawStones=[],this.drawCells=[],this.rotate=!1,this.translate="",this.viewport="0 0 1470 960",this.emptySource=new nt(0,0,0,0,0)}ngOnInit(){let t=this.level();t&&this.updateLevel(t)}gridID(t){return`${t.z}-${t.x}-${t.y}`}drawClass(t,n,e){let o="",l=this.matrix();return l.inBounds(t,n,e)||(o="invalid"),(l.isTile(t,n,e)||l.isTilePosBlocked(t,n,e))&&(o="tile"),l.isTilePosInvalid(t,n,e)&&(o="blocked"),t>0&&(l.isTile(t-1,n,e)||l.isTilePosBlocked(t-1,n,e))&&(o+=" below"),o}ngOnChanges(t){t.level&&this.updateLevel(t.level.currentValue)}onClickStone(t,n){this.clickStoneEvent.emit(n?.source),t.stopPropagation()}onClickBoard(t){this.clickBoardEvent.emit()}onClickDraw(t,n){this.clickDrawEvent.emit(n),t.stopPropagation()}updateLevel(t){if(this.drawCells=[],this.drawStones=[],!t?.rows)return;let n=[];for(let[e,o]of t.rows.entries())for(let[l,C]of o.entries()){let f={x:e,y:l,z:t.z,v:C,visible:!0,pos:ft(t.z,e,l),className:this.drawClass(t.z,e,l),source:C>0?new nt(t.z,e,l,C,0):this.emptySource};this.drawCells.push(f),f.v>0&&n.push(f)}this.drawStones=Ot(n),this.viewport=yt(this.drawCells)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-editor-board"]],inputs:{imageSet:[1,"imageSet"],level:[1,"level"],matrix:[1,"matrix"],isBoard:[1,"isBoard"]},outputs:{clickBoardEvent:"clickBoardEvent",clickDrawEvent:"clickDrawEvent",clickStoneEvent:"clickStoneEvent"},features:[N],decls:15,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","preserveAspectRatio","xMidYMin meet",1,"board-svg",3,"mousedown"],["id","filter4198-8",2,"color-interpolation-filters","sRGB"],["in","SourceGraphic","stdDeviation","8"],["id","front","width","300","height","400","viewBox","0 0 300 400"],["d","m 151.73588,1025.0177 c -3.32683,-9.3138 -10.24843,-68.45389 5.31821,-90.62655 20.27717,-26.12032 219.43558,-16.45796 231.55506,-9.93184 11.07433,5.31702 -178.60366,0.0589 -204.85126,34.86646 -21.59349,30.0006 -26.50086,82.17843 -32.02201,65.69193 z","transform","rotate(180,229,666.5)",2,"fill","#000000","fill-opacity","0.15","fill-rule","evenodd","stroke","none","filter","url(#filter4198-8)"],["transform","translate(28,-614)","d","M -4.7687833,775.07096 C -9.6501835,741.99485 -16.84552,674.23676 -1.2788716,652.0641 18.998297,625.94378 233.50094,631.63117 263.31435,653.90999 276.21398,662.64856 70.349579,663.12124 47.099353,691.74479 24.390958,719.11242 0.65060847,818.18718 -4.7687833,775.07096 Z",2,"fill","#ffffff","fill-opacity","0.4","fill-rule","evenodd","stroke","none","filter","url(#filter4198-8)"],[1,"stage"],["stroke","black","stroke-width","1","width","37.5px","height","50px",1,"draw",3,"class"],[1,"draw",3,"selected","hidden","hinted"],["stroke","black","stroke-width","1","width","37.5px","height","50px",1,"draw",3,"click"],[1,"draw",3,"mousedown"],[1,"tile"],["x","3","y","3","width","75px","height","100px","rx","10","ry","10",1,"shadow"],["x","0","y","0","width","75","height","100","rx","10","ry","10",1,"stone"],[0,"xlink","href","#front","x","0","y","0","width","75","height","100"]],template:function(n,e){n&1&&($(),Z(0,"svg",0),K("mousedown",function(l){return e.onClickBoard(l)}),Z(1,"defs")(2,"filter",1),H(3,"feGaussianBlur",2),Y(),Z(4,"svg",3),H(5,"path",4)(6,"path",5),Y()(),Z(7,"style"),u(8," g.tile { transform-origin: 50px 32.5px; opacity: 1; } g.selected g.tile { transform: scale(1.04); } g.selected g.tile rect.stone { stroke: black; fill: #F8EABB; } g.draw rect.shadow { fill: #191919; opacity: 0.6; stroke-width: 1; stroke: black; } g.draw rect.stone { fill: #FFF9E5; stroke-width: 1; stroke: black; } g.hidden { opacity: 0; } "),Y(),Z(9,"g",6),I(10,Xt,1,4,":svg:rect",7,St,!0),Y(),Z(12,"g",6),I(13,$t,5,7,":svg:g",8,St,!0),Y()()),n&2&&(T("rotate",e.rotate)("edit",e.isBoard()),G("viewBox",e.viewport),r(9),G("transform",e.translate),r(),B(e.drawCells),r(2),G("transform",e.translate),r(),B(e.drawStones))},styles:["[_nghost-%COMP%]{flex:1}[_nghost-%COMP%]   .board-svg[_ngcontent-%COMP%]{height:100%;width:100%;max-height:960px;background-color:var(--main-background-color);-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .board-svg[_ngcontent-%COMP%]   g.stage[_ngcontent-%COMP%]{transition:opacity .5s}[_nghost-%COMP%]   .board-svg[_ngcontent-%COMP%]   .draw[_ngcontent-%COMP%]{fill:#2b424f}[_nghost-%COMP%]   .board-svg[_ngcontent-%COMP%]   .draw.tile[_ngcontent-%COMP%]{fill:#fff9e5}[_nghost-%COMP%]   .board-svg.edit[_ngcontent-%COMP%]   .draw[_ngcontent-%COMP%]{fill:transparent;cursor:pointer}[_nghost-%COMP%]   .board-svg.edit[_ngcontent-%COMP%]   .draw.invalid[_ngcontent-%COMP%]{fill:#000;cursor:default}[_nghost-%COMP%]   .board-svg.edit[_ngcontent-%COMP%]   .draw.below[_ngcontent-%COMP%]{stroke:#d2691e;stroke-width:1px}[_nghost-%COMP%]   .board-svg.edit[_ngcontent-%COMP%]   .draw.tile[_ngcontent-%COMP%], [_nghost-%COMP%]   .board-svg.edit[_ngcontent-%COMP%]   .draw.blocked[_ngcontent-%COMP%]{fill:#0c1a1e;cursor:not-allowed}"]})}}return i})();var Gt=i=>({selected:i}),zt=(i,c)=>({z:i,rows:c,showStones:!0});function Ut(i,c){if(i&1){let t=b();a(0,"li",29),_("click",function(){let e=g(t).$index,o=p(2);return h(o.selectLevel(e))}),a(1,"div"),u(2),s(),a(3,"div",30)(4,"app-editor-board",31),_("clickBoardEvent",function(){let e=g(t).$index,o=p(2);return h(o.selectLevel(e))}),s()()()}if(i&2){let t=c.$implicit,n=c.$index,e=p(2);x("ngClass",mt(4,Gt,n===e.currentZ)),r(2),E("Level ",n),r(2),x("level",_t(6,zt,n,t))("matrix",e.matrix)}}function Wt(i,c){if(i&1&&(a(0,"div",26),$(),a(1,"svg",32)(2,"g",33),v(3,"path",34),s(),a(4,"text",35),u(5),s(),a(6,"text",36),u(7),s(),a(8,"text",37),u(9),s()()()),i&2){let t=p(2);r(5),L("x",t.stats.minX," \u2026 x",t.stats.maxX),r(2),L("z",t.stats.minZ," \u2026 z",t.stats.maxZ),r(2),L("y",t.stats.minY," \u2026 y",t.stats.maxY)}}function jt(i,c){if(i&1){let t=b();a(0,"button",38),_("click",function(){g(t);let e=p(2);return h(e.solve())}),u(1),d(2,"translate"),s()}i&2&&(r(),E(" ",m(2,1,"EDITOR_TEST_RUN")," "))}function Ht(i,c){if(i&1){let t=b();a(0,"button",38),_("click",function(){g(t);let e=p(2);return h(e.cancelSolve())}),u(1),d(2,"translate"),s()}i&2&&(r(),E(" ",m(2,1,"EDITOR_TEST_CANCEL")," "))}function Kt(i,c){if(i&1&&(a(0,"div")(1,"div"),u(2),d(3,"translate"),s(),a(4,"div"),u(5),d(6,"translate"),a(7,"span"),u(8),s()()()),i&2){let t=p(2);r(2),L("",m(3,6,"EDITOR_TEST_SOLVED"),": ",t.solveStats.won),r(3),E("",m(6,8,"EDITOR_TEST_FAILED"),": "),r(2),T("fail",t.solveStats.fail>0),r(),y(t.solveStats.fail)}}function qt(i,c){if(i&1){let t=b();a(0,"div",1)(1,"ul",2),I(2,Ut,5,9,"li",3,st),s(),a(4,"div",4)(5,"div",5)(6,"button",6),d(7,"translate"),_("click",function(){g(t);let e=p();return h(e.newLayerBelow(e.currentZ))}),v(8,"i",7),s()()()(),a(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",4)(13,"div",11)(14,"div",12),u(15),s(),a(16,"button",13),d(17,"translate"),_("click",function(){g(t);let e=p();return h(e.moveLayerZ(-1,e.currentZ))}),v(18,"i",14),s(),a(19,"button",13),d(20,"translate"),_("click",function(){g(t);let e=p();return h(e.moveLayerZ(1,e.currentZ))}),v(21,"i",15),s(),a(22,"button",6),d(23,"translate"),_("click",function(){g(t);let e=p();return h(e.duplicateLayerZ(e.currentZ))}),v(24,"i",16),s(),a(25,"button",6),d(26,"translate"),_("click",function(){g(t);let e=p();return h(e.clearLayerZ(e.currentZ))}),v(27,"i",17),s(),a(28,"button",6),d(29,"translate"),_("click",function(){g(t);let e=p();return h(e.deleteLayerZ(e.currentZ))}),v(30,"i",18),s(),a(31,"button",6),d(32,"translate"),_("click",function(){g(t);let e=p();return h(e.toggleMirrorX())}),u(33," \uFE31 "),s(),a(34,"button",6),d(35,"translate"),_("click",function(){g(t);let e=p();return h(e.toggleMirrorY())}),u(36," \u23AF "),s()(),a(37,"div",5)(38,"span"),u(39),s(),a(40,"button",6),d(41,"translate"),_("click",function(){g(t);let e=p();return h(e.moveLayerY(-1))}),v(42,"i",14),s(),a(43,"button",6),d(44,"translate"),_("click",function(){g(t);let e=p();return h(e.moveLayerY(1))}),v(45,"i",15),s(),a(46,"button",6),d(47,"translate"),_("click",function(){g(t);let e=p();return h(e.moveLayerX(-1))}),v(48,"i",19),s(),a(49,"button",6),d(50,"translate"),_("click",function(){g(t);let e=p();return h(e.moveLayerX(1))}),v(51,"i",20),s()()(),a(52,"div",21)(53,"app-editor-board",22),_("clickDrawEvent",function(e){g(t);let o=p();return h(o.onCellClick(e))})("clickStoneEvent",function(e){g(t);let o=p();return h(o.onStoneClick(e))}),s()()(),a(54,"div",23)(55,"div",4)(56,"div",5)(57,"div",12),u(58),d(59,"translate"),s()(),a(60,"div",5)(61,"span"),u(62),s(),a(63,"button",6),d(64,"translate"),_("click",function(){g(t);let e=p();return h(e.moveY(-1))}),v(65,"i",14),s(),a(66,"button",6),d(67,"translate"),_("click",function(){g(t);let e=p();return h(e.moveY(1))}),v(68,"i",15),s(),a(69,"button",6),d(70,"translate"),_("click",function(){g(t);let e=p();return h(e.moveX(-1))}),v(71,"i",19),s(),a(72,"button",6),d(73,"translate"),_("click",function(){g(t);let e=p();return h(e.moveX(1))}),v(74,"i",20),s()()(),a(75,"div",24),v(76,"app-layout-preview",25),M(77,Wt,10,6,"div",26),s(),a(78,"div",27)(79,"div",5)(80,"div"),M(81,jt,3,3,"button",28),M(82,Ht,3,3,"button",28),s()(),M(83,Kt,9,10,"div"),s()()()()}if(i&2){let t=p();r(2),B(t.matrix.levels),r(4),x("title",O(m(7,52,"EDITOR_NEW_LAYER_LONG"))),r(9),E("Level ",t.currentZ),r(),x("title",O(m(17,54,"EDITOR_MOVE_LAYER_DOWN_LONG")))("disabled",t.currentZ===0),r(3),x("title",O(m(20,56,"EDITOR_MOVE_LAYER_UP_LONG")))("disabled",t.currentZ===t.matrix.levels.length-1),r(3),x("title",O(m(23,58,"EDITOR_DUPLICATE_LAYER_LONG"))),r(3),x("title",O(m(26,60,"EDITOR_CLEAR_LAYER_LONG"))),r(3),x("title",O(m(29,62,"EDITOR_DELETE_LAYER_LONG"))),r(3),T("checked",t.mirrorX),x("title",O(m(32,64,"MIRROR_X"))),r(3),T("checked",t.mirrorY),x("title",O(m(35,66,"MIRROR_X"))),r(5),E("Tiles: ",t.stats.layerCount),r(),x("title",O(m(41,68,"EDITOR_MOVE_TILES_UP_LONG"))),r(3),x("title",O(m(44,70,"EDITOR_MOVE_TILES_DOWN_LONG"))),r(3),x("title",O(m(47,72,"EDITOR_MOVE_TILES_LEFT_LONG"))),r(3),x("title",O(m(50,74,"EDITOR_MOVE_TILES_RIGHT_LONG"))),r(4),x("level",t.level)("isBoard",!0)("matrix",t.matrix),r(5),y(m(59,76,"EDITOR_VIEW_FULL")),r(3),T("fail",t.stats.countInvalid),r(),E("Tiles: ",t.stats.totalCount),r(),x("title",O(m(64,78,"EDITOR_MOVE_ALL_TILES_UP_LONG"))),r(3),x("title",O(m(67,80,"EDITOR_MOVE_ALL_TILES_DOWN_LONG"))),r(3),x("title",O(m(70,82,"EDITOR_MOVE_ALL_TILES_LEFT_LONG"))),r(3),x("title",O(m(73,84,"EDITOR_MOVE_ALL_TILES_RIGHT_LONG"))),r(4),x("svg",t.svg),r(),P(t.stats?77:-1),r(4),P(t.solveWorker?-1:81),r(),P(t.solveWorker?82:-1),r(),P(t.solveStats?83:-1)}}function Jt(i,c){if(i&1){let t=b();a(0,"div",39),_("click",function(){g(t);let e=p();return h(e.toggleSave())}),a(1,"div",40),_("click",function(e){return g(t),h(e.stopPropagation())}),a(2,"span",41),d(3,"translate"),_("click",function(){g(t);let e=p();return h(e.toggleSave())}),v(4,"i",42),s(),a(5,"app-editor-export-component",43),_("savedEvent",function(){g(t);let e=p();return h(e.toggleAfterSave())}),s()()()}if(i&2){let t=p();r(2),x("title",O(m(3,3,"CLOSE"))),r(3),x("layout",t.layout())}}var tt=(()=>{class i{constructor(){this.layout=gt.required(),this.currentZ=0,this.totalZ=1,this.totalY=A.mY,this.totalX=A.mX,this.matrix=new X,this.saveDialog=!1,this.hasChanged=!1,this.mirrorX=!1,this.mirrorY=!1,this.worker=S(J),this.layoutService=S(R)}ngOnDestroy(){this.cancelSolve()}getStats(t){let n={name:t.name,totalCount:t.mapping.length,layerCount:t.mapping.filter(e=>e[0]===this.currentZ).length,countInvalid:t.mapping.length>144||!!(t.mapping.length%2),minX:100,maxX:0,minY:100,maxY:0,minZ:100,maxZ:0,height:0,width:0,depth:0};for(let e of t.mapping)e[0]<n.minZ&&(n.minZ=e[0]),e[0]>n.maxZ&&(n.maxZ=e[0]),e[1]<n.minX&&(n.minX=e[1]),e[1]>n.maxX&&(n.maxX=e[1]),e[2]<n.minY&&(n.minY=e[2]),e[2]>n.maxY&&(n.maxY=e[2]);return n.width=n.maxX-n.minX,n.height=n.maxY-n.minY,n.depth=n.maxZ-n.minZ,n}ngOnInit(){this.layout()&&(this.refresh(),this.hasChanged=!1)}ngOnChanges(t){t.layout&&(this.refresh(),this.hasChanged=!1)}removeStone(t,n,e){this.layout().mapping=this.layout().mapping.filter(o=>o[0]!==t||o[1]!==n||o[2]!==e),this.matrix.applyMapping(this.layout().mapping,this.totalZ,this.totalX,this.totalY)}addStone(t,n,e){this.layout().mapping.push([t,n,e]),this.matrix.applyMapping(this.layout().mapping,this.totalZ,this.totalX,this.totalY)}mirrorXValue(t){return this.totalX-2-t}mirrorYValue(t){return this.totalY-2-t}onPosClick(t,n,e){if(!(this.matrix.isTilePosBlocked(t,n,e)||this.matrix.isTilePosInvalid(t,n,e))){if(this.matrix.isTile(t,n,e)){this.removeStone(t,n,e);let o=[];this.mirrorX&&o.push([t,this.mirrorXValue(n),e]),this.mirrorY&&o.push([t,n,this.mirrorYValue(e)]),this.mirrorX&&this.mirrorY&&o.push([t,this.mirrorXValue(n),this.mirrorYValue(e)]);for(let[l,C,f]of o)this.matrix.isTile(l,C,f)&&this.removeStone(l,C,f)}else{this.addStone(t,n,e);let o=[];if(this.mirrorX){let l=this.mirrorXValue(n);o.push([t,l,e])}if(this.mirrorY){let l=this.mirrorYValue(e);o.push([t,n,l])}if(this.mirrorX&&this.mirrorY){let l=this.mirrorXValue(n),C=this.mirrorYValue(e);o.push([t,l,C])}for(let[l,C,f]of o)!this.matrix.isTilePosBlocked(l,C,f)&&!this.matrix.isTilePosInvalid(l,C,f)&&!this.matrix.isTile(l,C,f)&&this.addStone(l,C,f)}this.refresh()}}onCellClick(t){this.onPosClick(t.z,t.x,t.y)}onStoneClick(t){t&&this.onPosClick(t.z,t.x,t.y)}selectLevel(t){this.level={z:t,rows:this.matrix.levels[t],showTiles:!0},this.currentZ=t,this.refresh()}refresh(){let t=this.layout();t&&(this.hasChanged=!0,this.matrix.applyMapping(t.mapping,this.totalZ,this.totalX,this.totalY),this.stats=this.getStats(t),this.level={z:this.currentZ,rows:this.matrix.levels[this.currentZ],showTiles:!0},this.svg=this.layoutService.generatePreview(Q(t.mapping)),t.previewSVG=this.svg)}moveX(t){if(this.stats.minX+t<0||this.stats.maxX+t>=A.mX-1)return;let n=this.layout().mapping;for(let e of n)e[1]=e[1]+t;this.refresh()}moveY(t){if(this.stats.minY+t<0||this.stats.maxY+t>=A.mY-1)return;let n=this.layout().mapping;for(let e of n)e[2]=e[2]+t;this.refresh()}moveLayer(t,n){let e=this.layout().mapping.filter(w=>w[0]===this.currentZ),o=t?1:2,l=t?A.mX:A.mY,C=e[0][o],f=e[0][o];for(let w of e)C=Math.min(w[o],C),f=Math.max(w[o],f);if(!(C+n<0||f+n>=l-1)){for(let w of e)w[o]=w[o]+n;this.refresh()}}toggleMirrorX(){this.mirrorX=!this.mirrorX}toggleMirrorY(){this.mirrorY=!this.mirrorY}moveLayerX(t){this.moveLayer(!0,t)}moveLayerY(t){this.moveLayer(!1,t)}duplicateLayerZ(t){let n=[],e=this.layout().mapping;for(let o of e)o[0]>t?o[0]=o[0]+1:o[0]===t&&n.push(o);for(let o of n)e.push([t+1,o[1],o[2]]);this.refresh()}clearLayerZ(t){this.layout().mapping=this.layout().mapping.filter(n=>n[0]!==t),this.refresh()}deleteLayerZ(t){this.layout().mapping=this.layout().mapping.filter(n=>n[0]!==t);for(let n of this.layout().mapping)n[0]>t&&(n[0]=n[0]-1);this.totalZ=Math.max(this.totalZ-1,1),this.refresh()}newLayerBelow(t){this.totalZ+=1;let n=this.layout().mapping;for(let e of n)e[0]>t&&(e[0]=e[0]+1);this.refresh()}moveLayerZ(t,n){if(n+t<0||n+t>=this.matrix.levels.length)return;let e=this.layout().mapping;for(let o of e)o[0]===n?o[0]=o[0]+t:o[0]===n+t&&(o[0]=n);n===this.currentZ&&(this.currentZ=this.currentZ+t),this.refresh()}toggleSave(){this.saveDialog=!this.saveDialog}toggleAfterSave(){this.saveDialog=!1,this.hasChanged=!1}cancelSolve(){this.solveWorker&&(this.solveWorker.terminate(),this.solveWorker=void 0)}solve(){if(this.solveWorker)return;let t={fail:0,won:0};this.solveWorker=this.worker.solve(this.layout().mapping,1e3,n=>{t.won=n[0],t.fail=n[1]},n=>{t.won=n[0],t.fail=n[1],this.solveWorker=void 0}),this.solveStats=t}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-editor-layout-component"]],inputs:{layout:[1,"layout"]},outputs:{layout:"layoutChange"},features:[N],decls:2,vars:2,consts:[[1,"overlay","overlay-save"],[1,"editor-matrix-list"],[1,"matrix-list"],[3,"ngClass"],[1,"buttonbar"],[1,"buttons"],[3,"click","title"],[1,"icon-editor-list-add"],[1,"editor-selected"],[1,"matrix-edit"],[1,"matrix-edit-top"],[1,"buttons","buttons-current-level"],[1,"buttonbar-title"],[3,"click","disabled","title"],[1,"icon-editor-up-small"],[1,"icon-editor-down-small"],[1,"icon-editor-docs"],[1,"icon-editor-cancel-alt"],[1,"icon-editor-trash"],[1,"icon-editor-left-small"],[1,"icon-editor-right-small"],[1,"matrix-board"],[3,"clickDrawEvent","clickStoneEvent","level","isBoard","matrix"],[1,"matrix-edit-bottom"],[1,"matrix-preview"],[1,"svg-board",3,"svg"],[1,"dimensions"],[1,"stats","stats-bottom"],[1,"text-button"],[3,"click","ngClass"],[1,"matrix-level"],[3,"clickBoardEvent","level","matrix"],["xmlns","http://www.w3.org/2000/svg","height","100%","width","100%","x","0px","y","0px","viewBox","0 0 1600 1500"],["transform","translate(0, 300)"],["fill","#47b00a","d","M10,309.7c40.7-99.4,81.5-198.7,122.3-298c39.6,99.2,78.6,198.7,117.9,298c-31.6,0.1-63.2,0-94.8,0.1c0,167-0.1,334.1,0,501.1c148.5-103.4,296.4-207.8,444.8-311.4c-16.9-26.8-37-51.7-53.8-78.5c102.1-22.8,204.1-46,306.2-69C795.4,439.2,738,526.3,680.3,613.2c-17.6-25.2-35.1-50.4-52.9-75.4C480.9,640,334.5,742.4,188.5,845.4c167.8,0.3,335.6,0.1,503.4,0.1c0.1-32.5-0.1-64.9,0.1-97.3c99.4,40.7,198.7,81.5,298,122.3C890.8,910,791.3,949,691.9,988.3c-0.1-31.6,0-63.2-0.1-94.8c-193.7-0.1-387.4-0.1-581.1,0c-1.2,0-2.3-0.5-3.5-0.8c0.1-194.3,0.1-388.6,0-582.9C74.9,309.7,42.5,309.8,10,309.7L10,309.7z"],["x","100","y","1500","fill","#47b00a",2,"font","200px monospace"],["x","0","y","200","fill","#47b00a",2,"font","200px monospace"],["x","600","y","500","fill","#47b00a",2,"font","200px monospace"],[1,"text-button",3,"click"],[1,"overlay","overlay-save",3,"click"],[1,"overlay-popup",3,"click"],[1,"close",3,"click","title"],[1,"icon-cancel-circled2"],[3,"savedEvent","layout"]],template:function(n,e){n&1&&(M(0,qt,84,86),M(1,Jt,6,5,"div",0)),n&2&&(P(e.layout()?0:-1),r(),P(e.saveDialog?1:-1))},dependencies:[Ct,ht,Lt,U,kt,F],styles:["[_nghost-%COMP%]{display:flex;flex:1;flex-direction:row;color:var(--main-text-color);overflow:hidden}[_nghost-%COMP%]   .overlay-save[_ngcontent-%COMP%]   .overlay-popup[_ngcontent-%COMP%]{width:98%;height:98%;max-height:640px;max-width:640px;overflow-y:auto}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{padding-right:6px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   .fail[_ngcontent-%COMP%]{color:var(--text-fail-color)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;background-image:none;color:var(--text-highlight-color);border:1px solid var(--main-bg-color-dk);cursor:pointer}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--main-text-color-hover);border:1px solid var(--main-bg-color-lt)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button.checked[_ngcontent-%COMP%]{background-color:#0000004d;border:1px solid var(--main-bg-color-lt)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button.text-button[_ngcontent-%COMP%]{padding:10px 16px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{color:var(--text-disabled-color);cursor:default}[_nghost-%COMP%]   .buttons-current-level[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .buttonbar[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}[_nghost-%COMP%]   .buttonbar[_ngcontent-%COMP%]   .buttonbar-title[_ngcontent-%COMP%]{padding-left:12px;padding-right:12px}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]{width:220px;max-height:100%;height:100%;border-right:1px solid var(--dialog-border-color);overflow-y:auto;background-color:var(--editor-color-bg)}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:4px;max-height:100%}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   .matrix-level[_ngcontent-%COMP%]{display:flex;max-width:80%;margin:0 auto}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{text-align:center;cursor:pointer;border:1px solid var(--dialog-border-color);margin-bottom:4px;display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{border-color:var(--dialog-border-color-hover)}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]{border-color:var(--dialog-border-color-selected)}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;display:inline-block;min-width:.8em}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:auto}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;text-align:center;max-height:100%;overflow:hidden}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-top[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow:hidden}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-top[_ngcontent-%COMP%]   .matrix-board[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]{border-top:1px solid var(--dialog-border-color);height:25%;display:flex;flex-direction:column;position:relative;min-height:120px}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .matrix-preview[_ngcontent-%COMP%]{position:relative;overflow:hidden}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .matrix-preview[_ngcontent-%COMP%]   .dimensions[_ngcontent-%COMP%]{opacity:0;background-color:#000000b3;position:absolute;padding:8px;inset:0}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .matrix-preview[_ngcontent-%COMP%]:hover   .dimensions[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]{position:absolute;background-color:#000000b3;bottom:0;font-size:.9em;border-radius:6px;text-align:left;padding:10px;font-variant-numeric:slashed-zero tabular-nums}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .stats-bottom[_ngcontent-%COMP%]{text-align:right;right:0}@media only screen and (max-width:700px){[_nghost-%COMP%]{flex-direction:column}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]{height:80px;width:100%;overflow:auto hidden;margin-bottom:2px;border-right:none;border-bottom:1px solid var(--dialog-border-color)}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]{white-space:nowrap;border-right:none;height:92%}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{width:100px;height:100%;display:inline-flex}}@media only screen and (width>=400px)and (height<=600px){[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]{flex-direction:row}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-top[_ngcontent-%COMP%]{max-height:100%}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]{height:100%;width:30%;border-top:none}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block}}"]})}}return i})();var Dt=(()=>{class i{constructor(){this.appDropZone=k(),this.appDropZoneOver=k(),this.preventBodyDrop=V(!0),this.active=!1}onDrop(t){t.preventDefault(),this.active=!1;let{dataTransfer:n}=t;if(n?.items){let e=[],o=Array.from(n.items);for(let l of o)if(l?.kind==="file"){let C=l.getAsFile();C&&e.push(C)}n.items.clear(),this.appDropZone.emit(e)}else if(n){let e=n?.files;n.clearData(),e&&this.appDropZone.emit(Array.from(e))}}onDragOver(t){t.stopPropagation(),t.preventDefault(),this.active||this.appDropZoneOver.emit(),this.active=!0}onDragLeave(t){this.active=!1}onBodyDragOver(t){this.preventBodyDrop()&&(t.preventDefault(),t.stopPropagation())}onBodyDrop(t){this.preventBodyDrop()&&t.preventDefault()}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275dir=lt({type:i,selectors:[["","appDropZone",""]],hostVars:2,hostBindings:function(n,e){n&1&&_("drop",function(l){return e.onDrop(l)})("dragover",function(l){return e.onDragOver(l)})("dragleave",function(l){return e.onDragLeave(l)})("dragover",function(l){return e.onBodyDragOver(l)},et)("drop",function(l){return e.onBodyDrop(l)},et),n&2&&T("drop-zone-active",e.active)},inputs:{preventBodyDrop:[1,"preventBodyDrop"]},outputs:{appDropZone:"appDropZone",appDropZoneOver:"appDropZoneOver"}})}}return i})();function Qt(i,c){if(i&1){let t=b();a(0,"a",7),_("click",function(){g(t);let e=p().$implicit,o=p();return h(o.selectLayout(e.id))}),v(1,"i",8),u(2),s()}if(i&2){let t=p().$implicit;r(2),E(" ",t.msg)}}function te(i,c){if(i&1&&u(0),i&2){let t=p().$implicit;E(" ",t.msg," ")}}function ee(i,c){if(i&1&&(a(0,"p",6),M(1,Qt,3,1,"a"),M(2,te,1,1),s()),i&2){let t=c.$implicit;T("is-error",t.isError),r(),P(t.id?1:-1),r(),P(t.id?-1:2)}}var It=(()=>{class i{constructor(){this.editEvent=k(),this.layoutService=S(R),this.logs=[]}selectFiles(t){let e=t.currentTarget.files;e&&this.importFiles(Array.from(e))}importLayouts(t){return at(this,null,function*(){this.logs=[];let n=[];for(let e of t)try{let o=yield Mt(e);for(let l of o){let C=this.layoutService.expandLayout(l,!0);!this.layoutService.layouts.items.some(f=>f.id===C.id)&&!n.some(f=>f.id===C.id)?(n.push(R.layout2loadLayout(C,l.map)),this.logs.push({msg:`Imported: "${e.name}"`,id:C.id})):(console.error(`Similar layout to "${C.name}" already available. Import rejected`),this.logs.push({msg:`Similar layout to "${C.name}" already available. Import rejected.`,isError:!0}))}}catch(o){console.error("Error importing",e,o),this.logs.push({msg:`ERROR importing "${e.name}". Invalid file.`,isError:!0})}n.length>0&&this.layoutService.storeCustomBoards(n)})}selectLayout(t){let n=this.layoutService.layouts.items.find(e=>e.id===t);n&&this.editEvent.emit(n)}importFiles(t){this.importLayouts(t).catch(n=>{console.error(n)})}onDropFiles(t){this.importFiles(t)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-import-component"]],outputs:{editEvent:"editEvent"},decls:19,vars:12,consts:[[1,"import-section",3,"appDropZone"],[1,"drop-zone"],[1,"title"],["name","file","type","file","multiple","",3,"change"],[1,"log-zone"],[1,"layout",3,"is-error"],[1,"layout"],[3,"click"],[1,"icon-editor-ok"]],template:function(n,e){n&1&&(a(0,"div",0),_("appDropZone",function(l){return e.onDropFiles(l)}),a(1,"div",1)(2,"div",2),u(3),d(4,"translate"),v(5,"br"),u(6),d(7,"translate"),v(8,"br"),u(9),d(10,"translate"),v(11,"br"),u(12),d(13,"translate"),v(14,"br"),s(),a(15,"input",3),_("change",function(l){return e.selectFiles(l)}),s()(),a(16,"div",4),I(17,ee,3,4,"p",5,z),s()()),n&2&&(r(3),y(m(4,4,"EDITOR_IMPORT_DROP")),r(3),E(" ",m(7,6,"EDITOR_FORMAT_KYODAI")),r(3),E(" ",m(10,8,"EDITOR_FORMAT_KMAHJONGG")),r(3),E(" ",m(13,10,"EDITOR_FORMAT_MAH")),r(5),B(e.logs))},dependencies:[Dt,F],styles:["[_nghost-%COMP%]{flex:1;display:flex;color:var(--main-text-color);width:100%}[_nghost-%COMP%]   .import-section[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;flex-direction:column;width:100%}[_nghost-%COMP%]   .import-section[_ngcontent-%COMP%]   .drop-zone[_ngcontent-%COMP%]{padding:80px 30px;width:100%;max-width:800px;border:2px dashed var(--dialog-border-color);border-radius:20px;text-align:center;position:relative}[_nghost-%COMP%]   .import-section[_ngcontent-%COMP%]   .log-zone[_ngcontent-%COMP%]{margin-top:20px;max-height:300px;width:100%;max-width:800px;color:var(--main-text-color);overflow-y:auto}[_nghost-%COMP%]   .import-section[_ngcontent-%COMP%]   .log-zone[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .import-section[_ngcontent-%COMP%]   .log-zone[_ngcontent-%COMP%]   p.is-error[_ngcontent-%COMP%]{color:var(--text-fail-color)}[_nghost-%COMP%]   .import-section.drop-zone-active[_ngcontent-%COMP%]   .drop-zone[_ngcontent-%COMP%]{border:2px dashed var(--dialog-border-color)}"]})}}return i})();function ne(i,c){if(i&1&&(a(0,"div"),u(1),d(2,"translate"),s()),i&2){let t=p(2).$implicit,n=p();r(),L("",m(2,2,"EDITOR_TEST_SOLVED"),": ",n.test[t.id]==null?null:n.test[t.id].win)}}function ie(i,c){if(i&1&&(a(0,"div",20),u(1),d(2,"translate"),s()),i&2){let t=p(2).$implicit,n=p();r(),L("",m(2,2,"EDITOR_TEST_FAILED"),": ",n.test[t.id]==null?null:n.test[t.id].fail)}}function oe(i,c){if(i&1&&(a(0,"div"),M(1,ne,3,4,"div"),M(2,ie,3,4,"div",20),s()),i&2){let t=p().$implicit,n=p();r(),P(n.test[t.id]!=null&&n.test[t.id].win?1:-1),r(),P(n.test[t.id]!=null&&n.test[t.id].fail?2:-1)}}function re(i,c){if(i&1){let t=b();a(0,"button",9),d(1,"translate"),_("click",function(e){g(t);let o=p().$implicit,l=p();return h(l.removeCustomBoard(e,o))}),v(2,"i",12),s()}i&2&&x("title",O(m(1,2,"CUSTOM_BOARD_DELETE")))}function ae(i,c){if(i&1){let t=b();a(0,"tr",14),_("click",function(){let e=g(t).$implicit,o=p();return h(o.editLayout(e))}),a(1,"td",2),v(2,"app-layout-preview",15),s(),a(3,"td",16),u(4),s(),a(5,"td",17),u(6),s(),a(7,"td",18),u(8),s(),a(9,"td",8)(10,"button",9),d(11,"translate"),_("click",function(e){let o=g(t).$implicit,l=p();return h(l.testLayout(e,o))}),v(12,"i",10),s(),M(13,oe,3,2,"div"),s(),a(14,"td",11),M(15,re,3,4,"button",19),s()()}if(i&2){let t=c.$implicit,n=p();r(2),x("layout",t),r(2),y(t.name),r(2),y(t.category),r(2),y(t.mapping.length),r(2),x("title",O(m(11,8,"EDITOR_TEST_RUN"))),r(3),P(n.test[t.id]?13:-1),r(2),P(t.custom?15:-1)}}var Bt=(()=>{class i{constructor(){this.inputLayouts=V(),this.editEvent=k(),this.test={},this.sortColumn=1,this.sortDesc=!0,this.showBuildIn=!0,this.layoutService=S(R),this.workerService=S(J),this.update()}ngOnChanges(t){t.inputLayouts&&this.update()}ngOnDestroy(){this.worker&&(this.worker.terminate(),this.worker=void 0)}editLayout(t){this.editEvent.emit(t)}toggleBuildIn(){this.showBuildIn=!this.showBuildIn,this.update()}clickSortBy(t,n){this.sortColumn===n&&(this.sortDesc=!this.sortDesc),this.sortBy(n)}update(){let t=this.inputLayouts();t&&(this.layouts=t.sort((n,e)=>n.name.localeCompare(e.name)),this.showBuildIn||(this.layouts=this.layouts.filter(n=>n.custom)),this.sortBy(this.sortColumn))}removeCustomBoard(t,n){t.stopPropagation(),this.layoutService.removeCustomLayout([n.id]),this.update()}removeCustomLayouts(t){t.stopPropagation(),this.layoutService.removeAllCustomLayouts(),this.update()}sortBy(t){this.sortColumn=t,this.layouts=this.layouts.sort((n,e)=>{let o;switch(t){case 1:{o=n.name.localeCompare(e.name);break}case 2:{o=(n.by??"").localeCompare(e.by??"");break}case 3:{o=(n.category??"").localeCompare(e.category??"");break}case 4:{o=n.mapping.length-e.mapping.length;break}default:o=0}return(this.sortDesc?1:-1)*o})}testLayout(t,n){t.stopPropagation(),this.startTestLayout(n)}startTestLayout(t,n){if(this.worker){this.worker.terminate(),this.worker=void 0;return}this.test[t.id]=void 0,this.worker=this.workerService.solve(t.mapping,10,e=>{this.test[t.id]={win:e[0],fail:e[1]}},e=>{this.test[t.id]={win:e[0],fail:e[1]},this.worker=void 0,n&&n()})}testLayouts(t){if(this.worker){this.worker.terminate();return}this.testNextLayout()}testNextLayout(){let t=this.layouts.find(n=>!this.test[n.id]);t&&this.startTestLayout(t,()=>{this.testNextLayout()})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-manager-component"]],inputs:{inputLayouts:[1,"inputLayouts"]},outputs:{editEvent:"editEvent"},features:[N],decls:36,vars:39,consts:[[1,"layout-table"],[1,"layout","layout-header"],[1,"col-image"],[1,"col-name","sortable",3,"click"],[1,"arrow"],[1,"col-cat","sortable",3,"click"],["type","checkbox",3,"change","checked"],[1,"col-stats","sortable",3,"click"],[1,"col-test"],[3,"click","title"],[1,"icon-editor-paper-plane-empty"],[1,"col-delete"],[1,"icon-trash-empty"],[1,"layout"],[1,"layout",3,"click"],[1,"svg-board",3,"layout"],[1,"col-name"],[1,"col-cat"],[1,"col-stats"],[3,"title"],[1,"fail"]],template:function(n,e){n&1&&(a(0,"table",0)(1,"thead")(2,"tr",1)(3,"td",2),u(4),d(5,"translate"),s(),a(6,"td",3),_("click",function(l){return e.clickSortBy(l,1)}),u(7),d(8,"translate"),v(9,"span",4),s(),a(10,"td",5),_("click",function(l){return e.clickSortBy(l,3)}),u(11),d(12,"translate"),v(13,"span",4),a(14,"div")(15,"label")(16,"input",6),_("change",function(){return e.toggleBuildIn()}),s(),u(17),d(18,"translate"),s()()(),a(19,"td",7),_("click",function(l){return e.clickSortBy(l,4)}),u(20),d(21,"translate"),v(22,"span",4),s(),a(23,"td",8),u(24),d(25,"translate"),a(26,"button",9),d(27,"translate"),_("click",function(l){return e.testLayouts(l)}),v(28,"i",10),s()(),a(29,"td",11)(30,"button",9),d(31,"translate"),_("click",function(l){return e.removeCustomLayouts(l)}),v(32,"i",12),s()()()(),a(33,"tbody"),I(34,ae,16,10,"tr",13,z),s()()),n&2&&(r(4),y(m(5,23,"EDITOR_COLUMN_PREVIEW")),r(2),T("sort-up",e.sortColumn===1&&e.sortDesc)("sort-down",e.sortColumn===1&&!e.sortDesc),r(),E("",m(8,25,"EDITOR_LAYOUT_NAME")," "),r(3),T("sort-up",e.sortColumn===3&&e.sortDesc)("sort-down",e.sortColumn===3&&!e.sortDesc),r(),E("",m(12,27,"EDITOR_LAYOUT_CATEGORY")," "),r(5),x("checked",e.showBuildIn),r(),E(" ",m(18,29,"EDITOR_SHOW_BUILDIN")," "),r(2),T("sort-up",e.sortColumn===4&&e.sortDesc)("sort-down",e.sortColumn===4&&!e.sortDesc),r(),E("",m(21,31,"EDITOR_LAYOUT_NR_OF_STONES")," "),r(4),E("",m(25,33,"EDITOR_COLUMN_TEST")," "),r(2),x("title",O(m(27,35,"EDITOR_TEST_RUN"))),r(4),x("title",O(m(31,37,"CUSTOM_BOARD_DELETE_ALL"))),r(4),B(e.layouts))},dependencies:[U,F],styles:["[_nghost-%COMP%]{overflow-y:auto;flex:1}[_nghost-%COMP%]   .fail[_ngcontent-%COMP%]{color:var(--text-fail-color)}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]{color:var(--editor-table-row-color);width:100%}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%]{cursor:pointer;background-color:var(--editor-table-row-color-bg);height:80px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%]:hover{background-color:var(--editor-table-row-color-bg-hover)}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{vertical-align:middle;padding:4px 15px;border-top:1px solid var(--dialog-border-color);border-right:1px solid var(--dialog-border-color)}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-bottom:5px solid var(--main-text-color);display:none;margin-bottom:3px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%] > div.sortable[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%] > div.sort-up[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%] > div.sort-down[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{display:inline-block;transform:rotate(180deg)}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%]   .col-image[_ngcontent-%COMP%]{width:80px;height:80px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .col-test[_ngcontent-%COMP%]{width:140px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .col-cat[_ngcontent-%COMP%]{width:200px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .col-stats[_ngcontent-%COMP%]{width:140px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .col-delete[_ngcontent-%COMP%]{width:80px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout-header[_ngcontent-%COMP%]{max-height:30px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout-header[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border-top:none}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout-header[_ngcontent-%COMP%]:hover{background-color:#0000001a}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;background-image:none;color:var(--text-highlight-color);border:1px solid var(--main-bg-color-dk);cursor:pointer;text-align:center}[_nghost-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--main-text-color-hover);border:1px solid var(--main-bg-color-lt)}[_nghost-%COMP%]   button.text-button[_ngcontent-%COMP%]{padding:10px 16px}[_nghost-%COMP%]   button[disabled][_ngcontent-%COMP%]{color:var(--text-disabled-color);cursor:default}"]})}}return i})();function le(i,c){if(i&1){let t=b();a(0,"div")(1,"div",9)(2,"ul")(3,"li"),u(4),d(5,"translate"),d(6,"translate"),s()()(),a(7,"div",10)(8,"app-import-component",11),_("editEvent",function(e){g(t);let o=p();return h(o.editLayout(e))}),s()()()}i&2&&(r(4),L("",m(5,2,"EDITOR_TITLE"),": ",m(6,4,"EDITOR_IMPORT")))}function se(i,c){if(i&1){let t=b();a(0,"div")(1,"div",4)(2,"ul")(3,"li"),u(4),d(5,"translate"),s(),v(6,"li",5),a(7,"li")(8,"button",6),d(9,"translate"),_("click",function(){g(t);let e=p();return h(e.save())}),u(10),d(11,"translate"),s()()()(),a(12,"div",10),v(13,"app-editor-layout-component",12),s()()}if(i&2){let t=p();r(4),L("",m(5,6,"EDITOR_TITLE"),": ",t.layout.name),r(4),x("title",O(m(9,8,"EDITOR_SAVE_LONG"))),r(2),y(m(11,10,"EDITOR_SAVE")),r(3),x("layout",t.layout)}}var un=(()=>{class i{constructor(){this.closeEvent=k(),this.layoutComponent=ut(tt),this.mode="manager",this.layoutService=S(R),this.translate=S(q)}save(){let t=this.layoutComponent();t&&t.toggleSave()}close(){if(this.mode==="manager"){this.closeEvent.emit();return}let t=this.layoutComponent();(!(this.layout&&t?.hasChanged)||confirm(this.translate.instant("EDITOR_DISCARD_CHANGES_SURE")))&&(this.layout=void 0,this.mode="manager")}editLayout(t){this.mode="edit",this.layout={id:"",originalId:t.id,name:t.name,by:t.by??"",category:(t.custom?t.category:void 0)??"Custom",mapping:t.mapping.map(n=>[n[0],n[1],n[2]])}}exportLayouts(){Tt(this.layoutService.layouts.items)}newLayout(){this.editLayout({id:"",name:"New Board",category:"Custom",by:"",mapping:[]})}onDropFiles(){}onDragFiles(){this.mode="import"}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-editor-component"]],viewQuery:function(n,e){n&1&&ct(e.layoutComponent,tt,5),n&2&&pt()},outputs:{closeEvent:"closeEvent"},decls:30,vars:33,consts:[[1,"editor-content"],[1,"close",3,"click","title"],[1,"icon-cancel-circled2"],[1,"editor-manager"],[1,"editor-nav","buttons"],[1,"sep"],[3,"click","title"],[1,"editor-main",3,"appDropZone","appDropZoneOver"],[3,"editEvent","inputLayouts"],[1,"editor-nav"],[1,"editor-main"],[3,"editEvent"],[3,"layout"]],template:function(n,e){n&1&&(a(0,"div",0)(1,"a",1),d(2,"translate"),_("click",function(){return e.close()}),v(3,"i",2),s(),a(4,"div",3)(5,"div",4)(6,"ul")(7,"li"),u(8),d(9,"translate"),s(),v(10,"li",5),a(11,"li")(12,"button",6),d(13,"translate"),_("click",function(){return e.newLayout()}),u(14),d(15,"translate"),s()(),a(16,"li")(17,"button",6),d(18,"translate"),_("click",function(){return e.mode="import"}),u(19),d(20,"translate"),s()(),a(21,"li")(22,"button",6),d(23,"translate"),_("click",function(){return e.exportLayouts()}),u(24),d(25,"translate"),s()()()(),a(26,"div",7),_("appDropZone",function(){return e.onDropFiles()})("appDropZoneOver",function(){return e.onDragFiles()}),a(27,"app-manager-component",8),_("editEvent",function(l){return e.editLayout(l)}),s()()(),M(28,le,9,6,"div"),M(29,se,14,12,"div"),s()),n&2&&(r(),x("title",O(m(2,17,"CLOSE"))),r(3),T("visible",e.mode==="manager"),r(4),y(m(9,19,"EDITOR_TITLE")),r(4),x("title",O(m(13,21,"EDITOR_NEW_LONG"))),r(2),y(m(15,23,"EDITOR_NEW")),r(3),x("title",O(m(18,25,"EDITOR_IMPORT_LONG"))),r(2),y(m(20,27,"EDITOR_IMPORT")),r(3),x("title",O(m(23,29,"EDITOR_EXPORT_LONG"))),r(2),y(m(25,31,"EDITOR_EXPORT")),r(3),x("inputLayouts",e.layoutService.layouts.items),r(),P(e.mode==="import"?28:-1),r(),P(e.mode==="edit"&&e.layout?29:-1))},dependencies:[tt,It,Bt,F],styles:["[_nghost-%COMP%]{--editor-table-row-color: #fff;--editor-color-bg: #1e2e37;--editor-table-row-color-bg: #1e2e37;--editor-table-row-color-bg-hover: #2b424f;position:absolute;inset:0;background-color:var(--editor-color-bg);z-index:10001}[_nghost-%COMP%]   a[_ngcontent-%COMP%]{color:var(--main-content-link-color);cursor:pointer}[_nghost-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--main-content-link-hover-color)}[_nghost-%COMP%]   .close[_ngcontent-%COMP%]{position:absolute;right:10px;top:8px;cursor:pointer}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;background-image:none;border:1px solid var(--main-bg-color-dk);cursor:pointer;font-size:1em;color:var(--text-highlight-color);padding:2px 16px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--main-text-color-hover);border:1px solid var(--main-text-color-hover)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{color:var(--text-disabled-color);cursor:default}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-manager[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-manager.visible[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-nav[_ngcontent-%COMP%]{padding:4px 8px 8px;border-bottom:1px solid var(--dialog-border-color)}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:0;margin:0 40px 0 0;list-style:none;display:flex}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;padding-left:8px}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.sep[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{color:#ff0;cursor:default}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden}"]})}}return i})();export{un as EditorComponent};
