"use strict";(self.webpackChunkmah=self.webpackChunkmah||[]).push([[254],{254:($t,w,p)=>{p.r(w),p.d(w,{EditorModule:()=>Lt});var I=p(177),g=p(9695),A=p(8398),t=p(9953),m=p(2943),C=p(74);class f{constructor(){this.levels=[],this.init(2,2,1)}init(r,n,e){const o=new Array(e);for(let a=0;a<e;a++){o[a]=new Array(r);for(let s=0;s<r;s++){o[a][s]=new Array(n);for(let c=0;c<n;c++)o[a][s][c]=0}}this.levels=o}clear(){const r=this.levels;for(let n=0;n<r.length;n++)for(let e=0;e<r[n].length;e++)for(let o=0;o<r[n][e].length;o++)r[n][e][o]=0}inBounds(r,n,e){return r>=0&&n>=0&&e>=0&&r<this.levels.length&&n<this.levels[0].length&&e<this.levels[0][0].length}isTile(r,n,e){return this.levels[r][n][e]>0}isTilePosInvalid(r,n,e){return!this.levels[r][n+1]||this.levels[r][n].length-1===e||this.levels[r][n][e+1]>0||(this.levels[r][n-1]?this.levels[r][n-1][e+1]:0)>0||(this.levels[r][n-1]?this.levels[r][n-1][e-1]:0)>0||(this.levels[r][n+1]?this.levels[r][n+1][e]:0)>0||(this.levels[r][n+1]?this.levels[r][n+1][e-1]:0)>0||(this.levels[r][n+1]?this.levels[r][n+1][e-1]:0)>0||(this.levels[r][n+1]?this.levels[r][n+1][e+1]:0)>0}isTilePosBlocked(r,n,e){return this.levels[r][n][e-1]>0||!!this.levels[r][n-1]&&(this.levels[r][n-1][e]>0||this.levels[r][n-1][e-1]>0)}get(r,n,e){return this.levels[r][n][e]||0}setValue(r,n,e,o){this.levels[r][n][e]=o}applyMapping(r,n,e,o){const a=(0,C.We)(r,n,e,o);this.init(a.x+1,a.y+1,a.z),r.forEach(s=>{this.setValue(s[0],s[1],s[2],1)})}}var u=p(514),R=p(8807),h=p(467);function M(){return(M=(0,h.A)(function*(i,r,n,e,o){const a=r*n;if(o.length!==a*i)return Promise.reject(Error("Invalid Matrix Pattern length"));const c={name:e,cat:"Kyodai",mapping:[]};for(let l=0;l<i;l++){const _=o.slice(l*a,(l+1)*a);for(let d=0;d<r;d++)_.slice(d*n,(d+1)*n).split("").forEach((Dt,Ft)=>{"1"===Dt&&c.mapping.push([l,Ft,d])})}return c})).apply(this,arguments)}function O(){return(O=(0,h.A)(function*(i,r){return function j(i,r,n,e,o){return M.apply(this,arguments)}(5,20,34,i,r)})).apply(this,arguments)}function L(i,r){return b.apply(this,arguments)}function b(){return(b=(0,h.A)(function*(i,r){const n=[];return i.forEach((e,o)=>{const a=Math.floor(o/r),s=o%r;e.split("").forEach((c,l)=>{"1"===c&&n.push([a,l,s])})}),n})).apply(this,arguments)}function x(){return(x=(0,h.A)(function*(i,r){let n=i.replace(/\r\n/g,"\n").split("\n");const e=r.split(".");e.pop();const o=n.shift()||"",a={name:e.join(".").replace(/_/g," "),cat:"uncategorized",mapping:[]};if(["kmahjongg-layout-v1.0"].includes(o))return a.by="KDE Games team",a.mapping=yield L(n.filter(s=>!s.startsWith("#")),16),a;if(["kmahjongg-layout-v1.1"].includes(o)){const s=Number((n.find(_=>_.startsWith("h"))||"h16").split("").slice().join("")),c=(n.find(_=>_.startsWith("# name:"))||"").slice(7).trim();a.name=c||a.name;const l=(n.find(_=>_.startsWith("# by:"))||"").slice(5).trim();return a.by=l||a.by,n=n.filter(_=>!(_.startsWith("h")||_.startsWith("w")||_.startsWith("d")||_.startsWith("#"))),a.mapping=yield L(n,isNaN(s)?16:s),a}return Promise.reject(Error(`Unknown .layout format ${JSON.stringify((o||"").slice(0,50))}`))})).apply(this,arguments)}function P(){return P=(0,h.A)(function*(i,r){const n=i.replace(/\r\n/g,"\n").split("\n"),e=n[0]||"";if(["Kyodai 3.0","Kyodai 6.0"].includes(e)){const o=(n[1]||"").split("::"),a=o[0]||"",s=o[1]||"uncategorized",c=n[2]||"",l=yield function Y(i,r){return O.apply(this,arguments)}(a,c);return l.cat=s||l.cat,l}return Promise.reject(Error(`Unknown .lay format ${JSON.stringify((e||"").slice(0,50))}`))}),P.apply(this,arguments)}function D(i){const r={};(function Z(i){return i.sort((r,n)=>r[0]<n[0]?-1:r[0]>n[0]?1:r[1]<n[1]?-1:r[1]>n[1]?1:r[2]<n[2]?-1:r[2]>n[2]?1:0)})(i).forEach(e=>{r[e[0]]=r[e[0]]||{},r[e[0]][e[2]]=r[e[0]][e[2]]||[],r[e[0]][e[2]].push(e[1])});const n=[];for(const e of Object.keys(r)){const o=[];for(const a of Object.keys(r[Number(e)])){const s=r[Number(e)][Number(a)],c=[];let l={start:-1,current:-1,count:0};s.forEach(d=>{d!==l.current?(l={start:d,current:d+2,count:1},c.push(l)):(l.current+=2,l.count++)});const _=c.map(d=>1===d.count?d.start:[d.start,d.count]);1!==_.length||Array.isArray(_[0])?o.push([Number(a),_]):o.push([Number(a),_[0]])}n.push([Number(e),o])}return n}function F(i){const r=i.name.split(" by ");r.length>1&&(i.name=r[0].trim(),i.by=r[1].trim()),i.name=i.name.trim().split(" ").map(e=>e[0].toUpperCase()+e.slice(1)).join(" ").replace(/["']/g,""),i.by=i.by?i.by.trim().split(" ").map(e=>e[0].toUpperCase()+e.slice(1)).join(" ").replace(/["]/g,""):void 0;const n=y(i.mapping);return{id:(0,C.xw)(n),name:i.name.trim(),cat:i.cat,by:i.by,map:D(n)}}function y(i){if(0===i.length)return[];let r=i[0][0],n=i[0][1],e=i[0][2];return i.forEach(o=>{r=Math.min(o[0],r),n=Math.min(o[1],n),e=Math.min(o[2],e)}),i.map(o=>[o[0]-(r||0),o[1]-(n||0),o[2]-(e||0)])}function k(){return(k=(0,h.A)(function*(i){const r=new FileReader;return new Promise((n,e)=>{r.onload=()=>{n(r.result)},r.onerror=()=>{e(Error(`Reading File failed: ${r.error}`))},r.readAsBinaryString(i)})})).apply(this,arguments)}function J(i){return E.apply(this,arguments)}function E(){return E=(0,h.A)(function*(i){const r=yield function z(i){return k.apply(this,arguments)}(i),n=(i.name.split(".").pop()||"").toLowerCase();let e;if("lay"===n)e=F(yield function W(i,r){return P.apply(this,arguments)}(r,i.name));else{if("layout"!==n)return JSON.parse(r).boards;e=F(yield function U(i,r){return x.apply(this,arguments)}(r,i.name))}return[e]}),E.apply(this,arguments)}var T=p(4997),$=p(9189),S=p(3828);const H=(i,r)=>r.source.groupnr+"/"+r.source.v;function K(i,r){if(1&i){const n=t.RV6();t.qSk(),t.j41(0,"rect",9),t.bIt("click",function(o){const a=t.eBV(n).$implicit,s=t.XpG();return t.Njj(s.onClickDraw(o,a))}),t.k0s()}if(2&i){const n=r.$implicit;t.HbH(n.className),t.BMQ("x",n.pos.x)("y",n.pos.y)}}function Q(i,r){if(1&i){const n=t.RV6();t.qSk(),t.j41(0,"g",10),t.bIt("mousedown",function(o){const a=t.eBV(n).$implicit,s=t.XpG();return t.Njj(s.onClickStone(o,a))}),t.j41(1,"g",11),t.nrm(2,"rect",12)(3,"rect",13)(4,"use",14),t.k0s()()}if(2&i){const n=r.$implicit;t.AVh("selected",n.source.selected)("hidden",n.source.picked)("hinted",n.source.hinted),t.BMQ("transform",n.pos.translate)}}let q=(()=>{class i{constructor(){this.clickBoardEvent=new t.bkB,this.clickDrawEvent=new t.bkB,this.clickStoneEvent=new t.bkB,this.drawStones=[],this.drawCells=[],this.rotate=!1,this.translate="",this.viewport="0 0 1470 960",this.emptySource=new $.w(0,0,0,0,0)}ngOnInit(){this.level&&this.updateLevel(this.level)}drawClass(n,e,o){let a="";return this.matrix.inBounds(n,e,o)||(a="invalid"),(this.matrix.isTile(n,e,o)||this.matrix.isTilePosBlocked(n,e,o))&&(a="tile"),this.matrix.isTilePosInvalid(n,e,o)&&(a="blocked"),n>0&&(this.matrix.isTile(n-1,e,o)||this.matrix.isTilePosBlocked(n-1,e,o))&&(a+=" below"),a}ngOnChanges(n){n.level&&this.updateLevel(n.level.currentValue)}onClickStone(n,e){this.clickStoneEvent.emit(e?.source),n.stopPropagation()}onClickBoard(n){this.clickBoardEvent.emit()}onClickDraw(n,e){this.clickDrawEvent.emit(e),n.stopPropagation()}calcDrawPos(n,e,o){const a={x:(u.fV.tileWidth+2)*e/2+4,y:(u.fV.tileHeight+2)*o/2+4,z:o+u.fV.mY*(e+u.fV.mX*n),translate:""};return a.translate=`translate(${a.x},${a.y})`,a}updateLevel(n){if(this.drawCells=[],this.drawStones=[],!n||!n.rows)return;const e=[];n.rows.forEach((o,a)=>{o.forEach((s,c)=>{const l={x:a,y:c,z:n.z,v:s,visible:!0,pos:this.calcDrawPos(n.z,a,c),className:this.drawClass(n.z,a,c),source:s>0?new $.w(n.z,a,c,s,0):this.emptySource};this.drawCells.push(l),l.v>0&&e.push(l)})}),this.drawStones=(0,S.bR)(e),this.viewport=(0,S.LU)(this.drawCells,1470,960,!1)}static#t=this.\u0275fac=function(e){return new(e||i)};static#n=this.\u0275cmp=t.VBU({type:i,selectors:[["app-editor-board"]],inputs:{imageSet:"imageSet",level:"level",matrix:"matrix",isBoard:"isBoard"},outputs:{clickBoardEvent:"clickBoardEvent",clickDrawEvent:"clickDrawEvent",clickStoneEvent:"clickStoneEvent"},features:[t.OA$],decls:15,vars:7,consts:[["xmlns","http://www.w3.org/2000/svg","preserveAspectRatio","xMidYMin meet",1,"board-svg",3,"mousedown"],["id","filter4198-8",2,"color-interpolation-filters","sRGB"],["in","SourceGraphic","stdDeviation","8"],["id","front","width","300","height","400","viewBox","0 0 300 400"],["d","m 151.73588,1025.0177 c -3.32683,-9.3138 -10.24843,-68.45389 5.31821,-90.62655 20.27717,-26.12032 219.43558,-16.45796 231.55506,-9.93184 11.07433,5.31702 -178.60366,0.0589 -204.85126,34.86646 -21.59349,30.0006 -26.50086,82.17843 -32.02201,65.69193 z","transform","rotate(180,229,666.5)",2,"fill","#000000","fill-opacity","0.15","fill-rule","evenodd","stroke","none","filter","url(#filter4198-8)"],["transform","translate(28,-614)","d","M -4.7687833,775.07096 C -9.6501835,741.99485 -16.84552,674.23676 -1.2788716,652.0641 18.998297,625.94378 233.50094,631.63117 263.31435,653.90999 276.21398,662.64856 70.349579,663.12124 47.099353,691.74479 24.390958,719.11242 0.65060847,818.18718 -4.7687833,775.07096 Z",2,"fill","#ffffff","fill-opacity","0.4","fill-rule","evenodd","stroke","none","filter","url(#filter4198-8)"],[1,"stage"],["stroke","black","stroke-width","1","width","37.5px","height","50px",1,"draw",3,"class"],[1,"draw",3,"selected","hidden","hinted"],["stroke","black","stroke-width","1","width","37.5px","height","50px",1,"draw",3,"click"],[1,"draw",3,"mousedown"],[1,"tile"],["x","3","y","3","width","75px","height","100px","rx","10","ry","10",1,"shadow"],["x","0","y","0","width","75","height","100","rx","10","ry","10",1,"stone"],[0,"xlink","href","#front","x","0","y","0","width","75","height","100"]],template:function(e,o){1&e&&(t.qSk(),t.j41(0,"svg",0),t.bIt("mousedown",function(s){return o.onClickBoard(s)}),t.j41(1,"defs")(2,"filter",1),t.nrm(3,"feGaussianBlur",2),t.k0s(),t.j41(4,"svg",3),t.nrm(5,"path",4)(6,"path",5),t.k0s()(),t.j41(7,"style"),t.EFF(8," g.tile { transform-origin: 50px 32.5px; opacity: 1; } g.selected g.tile { transform: scale(1.04); } g.selected g.tile rect.stone { stroke: black; fill: #F8EABB; } g.draw rect.shadow { fill: #191919; opacity: 0.6; stroke-width: 1; stroke: black; } g.draw rect.stone { fill: #FFF9E5; stroke-width: 1; stroke: black; } g.hidden { opacity: 0; } "),t.k0s(),t.j41(9,"g",6),t.Z7z(10,K,1,4,":svg:rect",7,t.fX1),t.k0s(),t.j41(12,"g",6),t.Z7z(13,Q,5,7,":svg:g",8,H),t.k0s()()),2&e&&(t.AVh("rotate",o.rotate)("edit",o.isBoard),t.BMQ("viewBox",o.viewport),t.R7$(9),t.BMQ("transform",o.translate),t.R7$(),t.Dyx(o.drawCells),t.R7$(2),t.BMQ("transform",o.translate),t.R7$(),t.Dyx(o.drawStones))},styles:["[_nghost-%COMP%]{flex:1}[_nghost-%COMP%]   .board-svg[_ngcontent-%COMP%]{height:100%;width:100%;max-height:960px;background-color:var(--main-background-color);-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .board-svg[_ngcontent-%COMP%]   g.stage[_ngcontent-%COMP%]{transition:opacity .5s}[_nghost-%COMP%]   .board-svg[_ngcontent-%COMP%]   .draw[_ngcontent-%COMP%]{fill:#2b424f}[_nghost-%COMP%]   .board-svg[_ngcontent-%COMP%]   .draw.tile[_ngcontent-%COMP%]{fill:#fff9e5}[_nghost-%COMP%]   .board-svg.edit[_ngcontent-%COMP%]   .draw[_ngcontent-%COMP%]{fill:transparent;cursor:pointer}[_nghost-%COMP%]   .board-svg.edit[_ngcontent-%COMP%]   .draw.invalid[_ngcontent-%COMP%]{fill:#000;cursor:default}[_nghost-%COMP%]   .board-svg.edit[_ngcontent-%COMP%]   .draw.below[_ngcontent-%COMP%]{stroke:#d2691e;stroke-width:1px}[_nghost-%COMP%]   .board-svg.edit[_ngcontent-%COMP%]   .draw.tile[_ngcontent-%COMP%], [_nghost-%COMP%]   .board-svg.edit[_ngcontent-%COMP%]   .draw.blocked[_ngcontent-%COMP%]{fill:#0c1a1e;cursor:not-allowed}"]})}return i})();function tt(i){return B([i])}function B(i){return JSON.stringify(function nt(i){return{mah:"1.0",boards:i.map(n=>N(n))}}(i))}function N(i){const r=y(i.mapping);return{id:(0,C.xw)(r),name:i.name,by:i.by?i.by:void 0,cat:i.category?i.category:void 0,map:D(r)}}function et(i){const r=new f,n=(0,C.We)(i.mapping,0,0,0);r.init(n.x+1,n.y+1,n.z),i.mapping.forEach(o=>{const a=o[0],s=o[1],c=o[2];r.setValue(a,s,c,1),r.setValue(a,s+1,c,2),r.setValue(a,s,c+1,4),r.setValue(a,s+1,c+1,3)});const e=[];return e.push("mahjongg-layout-v1.1"),e.push(`# name: ${i.name}`),e.push(`# by: ${i.by}`),e.push(`# category: ${i.category}`),e.push("# Board size in quarter tiles"),e.push(`w${n.x+1}`),e.push(`h${n.y+1}`),e.push("# Board depth"),e.push(`d${n.z}`),r.levels.forEach((o,a)=>{const s=`# Level ${a} `;e.push(`${s}${"-".repeat(Math.max(n.x-s.length,0))}`);for(let c=0;c<=n.y;c++){const l=[];for(let _=0;_<=n.x;_++)l.push(o[_][c]||".");e.push(l.join(""))}}),e.join("\n")}function rt(i){return`Kyodai 6.0\n${i.name}${i.by?` by ${i.by}`:""}${i.category?` :: ${i.category}`:""}\n${function it(i){const r=new f,a=function ot(i,r,n){const e=(0,C.We)(i,0,0,0),o=Math.max(0,Math.floor((n-e.y)/2)),a=Math.max(0,Math.floor((r-e.x)/2));return i.map(s=>[s[0],s[1]+a,s[2]+o])}(i,34,20);r.applyMapping(a,5,34,20);const s=[];for(let c=0;c<5;c++)for(let l=0;l<20;l++)for(let _=0;_<34;_++)s.push(r.get(c,_,l).toString());return s.join("")}(i.mapping)}\n`}function G(i,r,n){const e=new Blob([r],{type:n}),o=document.createElement("a");o.href=window.URL.createObjectURL(e),o.download=i,o.click()}function st(i,r){if(1&i){const n=t.RV6();t.j41(0,"div",0)(1,"div",6)(2,"label"),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"input",7),t.bIt("input",function(o){t.eBV(n);const a=t.XpG();return t.Njj(a.layout.name=o.target.value)})("change",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.update())})("blur",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.update())}),t.k0s(),t.j41(6,"label"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.j41(9,"input",7),t.bIt("input",function(o){t.eBV(n);const a=t.XpG();return t.Njj(a.layout.by=o.target.value)})("change",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.update())})("blur",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.update())}),t.k0s(),t.j41(10,"label"),t.EFF(11),t.nI1(12,"translate"),t.k0s(),t.j41(13,"input",7),t.bIt("input",function(o){t.eBV(n);const a=t.XpG();return t.Njj(a.layout.category=o.target.value)})("change",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.update())})("blur",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.update())}),t.k0s()(),t.j41(14,"div",8),t.nrm(15,"app-layout-preview",9),t.k0s()()}if(2&i){const n=t.XpG();t.R7$(3),t.JRh(t.bMT(4,7,"EDITOR_LAYOUT_NAME")),t.R7$(2),t.Y8G("value",n.layout.name),t.R7$(2),t.JRh(t.bMT(8,9,"EDITOR_LAYOUT_BY")),t.R7$(2),t.Y8G("value",n.layout.by),t.R7$(2),t.JRh(t.bMT(12,11,"EDITOR_LAYOUT_CATEGORY")),t.R7$(2),t.Y8G("value",n.layout.category),t.R7$(2),t.Y8G("layout",n.layout)}}function lt(i,r){if(1&i){const n=t.RV6();t.j41(0,"li")(1,"input",10),t.bIt("change",function(){const o=t.eBV(n).$implicit,a=t.XpG();return t.Njj(a.chooseFormat(o))}),t.k0s(),t.j41(2,"label",11),t.EFF(3),t.k0s()()}if(2&i){const n=r.$implicit,e=t.XpG();t.R7$(),t.Y8G("id","format_"+n.name)("value",n)("checked",e.format===n),t.R7$(),t.Y8G("for","format_"+n.name),t.R7$(),t.JRh(n.name)}}function ct(i,r){if(1&i){const n=t.RV6();t.j41(0,"button",4),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.saveAsCopy())}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}2&i&&(t.R7$(),t.JRh(t.bMT(2,1,"EDITOR_LAYOUT_SAVE_AS_COPY")))}let _t=(()=>{class i{constructor(n,e){this.translate=n,this.layoutService=e,this.savedEvent=new t.bkB,this.exportFormats=[{name:"Mah",ext:"mah",func:tt,type:"text/json"},{name:"Kyodai",ext:"lay",func:rt,type:"text/lay"},{name:"Kmahjongg",ext:"layout",func:et,type:"text/layout"}],this.format=this.exportFormats[0]}ngOnInit(){this.layout&&this.update()}ngOnChanges(n){n.layout&&this.update()}saveAsCopy(){this.layoutService.storeCustomBoards([this.exportLayout]),this.layout.originalId=this.exportLayout.id,this.savedEvent.emit(!0)}save(){if(this.layoutService.layouts.items.find(e=>!e.custom&&e.id===this.exportLayout.id))return void alert(this.translate.instant("EDITOR_BUILD_IN_EXISTS"));const n=[this.exportLayout.id];this.layout.originalId&&n.push(this.layout.originalId),this.layoutService.removeCustomLayout(n),this.saveAsCopy()}chooseFormat(n){this.format=n,this.update()}download(){G(this.filename,this.output,this.format.type),this.savedEvent.emit(!0)}update(){this.layoutName=this.layout.name.toLocaleLowerCase().replace(/ /g,"_"),this.output=this.format.func(this.layout),this.filename=`${this.layoutName}.${this.format.ext}`,this.exportLayout=N(this.layout)}static#t=this.\u0275fac=function(e){return new(e||i)(t.rXU(g.c$),t.rXU(m.Y))};static#n=this.\u0275cmp=t.VBU({type:i,selectors:[["app-editor-export-component"]],inputs:{layout:"layout"},outputs:{savedEvent:"savedEvent"},features:[t.OA$],decls:24,vars:16,consts:[[1,"section"],[1,"export"],[1,"export-preview"],[1,"buttons"],[1,"text-button",3,"click"],[1,"text-button"],[1,"inputs"],["type","text",3,"input","change","blur","value"],[1,"preview"],[1,"svg-board",3,"layout"],["type","radio","name","format",3,"change","id","value","checked"],[3,"for"]],template:function(e,o){1&e&&(t.j41(0,"h3"),t.EFF(1),t.nI1(2,"translate"),t.nI1(3,"translate"),t.k0s(),t.DNE(4,st,16,13,"div",0),t.j41(5,"div",1)(6,"label"),t.EFF(7,"Format"),t.k0s(),t.j41(8,"fieldset")(9,"ul"),t.Z7z(10,lt,4,5,"li",null,t.fX1),t.k0s()(),t.j41(12,"div",2)(13,"pre"),t.EFF(14),t.k0s()(),t.nrm(15,"br"),t.j41(16,"div",3)(17,"button",4),t.bIt("click",function(){return o.download()}),t.EFF(18),t.nI1(19,"translate"),t.k0s(),t.DNE(20,ct,3,3,"button",5),t.j41(21,"button",4),t.bIt("click",function(){return o.save()}),t.EFF(22),t.nI1(23,"translate"),t.k0s()()()),2&e&&(t.R7$(),t.Lme("",t.bMT(2,8,"EDITOR_SAVE")," / ",t.bMT(3,10,"EDITOR_EXPORT"),""),t.R7$(3),t.vxM(o.layout?4:-1),t.R7$(6),t.Dyx(o.exportFormats),t.R7$(4),t.JRh(o.output),t.R7$(4),t.Lme("",t.bMT(19,12,"EDITOR_LAYOUT_DOWNLOAD")," ",o.filename,""),t.R7$(2),t.vxM(o.layout&&o.layout.originalId&&o.exportLayout.id!==o.layout.originalId?20:-1),t.R7$(2),t.JRh(t.bMT(23,14,"EDITOR_LAYOUT_SAVE")))},dependencies:[T.M,g.D9],styles:["[_nghost-%COMP%]{color:var(--main-text-color)}[_nghost-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;padding-top:0;text-align:center}[_nghost-%COMP%]   .preview[_ngcontent-%COMP%]{max-height:180px;min-width:100px;padding-left:10px}[_nghost-%COMP%]   .inputs[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}[_nghost-%COMP%]   .inputs[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:4px;font-size:16px;margin-bottom:8px}@media only screen and (max-width: 400px){[_nghost-%COMP%]   .preview[_ngcontent-%COMP%]{display:none}}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:flex}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{vertical-align:middle;cursor:pointer}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] + li[_ngcontent-%COMP%]{margin-left:10px}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   .export-preview[_ngcontent-%COMP%]{margin-top:16px}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   .export-preview[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{white-space:pre-line;word-wrap:break-word;font-family:monospace;text-align:left;overflow:auto;min-height:180px;max-height:180px;font-size:.8em;line-height:1em;background-color:#000}[_nghost-%COMP%]   .export[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 16px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{text-align:center;display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;background-color:#0000000d;background-image:none;border:1px solid var(--dialog-border-color);cursor:pointer;color:var(--main-text-color)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--main-text-color-hover);background-color:#0000001a;border:1px solid var(--dialog-border-color-hover)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button.text-button[_ngcontent-%COMP%]{padding:10px 16px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{color:var(--text-disabled-color);cursor:default}"]})}return i})();const pt=i=>({selected:i}),dt=(i,r)=>({z:i,rows:r,showStones:!0});function ut(i,r){if(1&i){const n=t.RV6();t.j41(0,"li",29),t.bIt("click",function(){const o=t.eBV(n).$index,a=t.XpG(2);return t.Njj(a.selectLevel(o))}),t.j41(1,"div"),t.EFF(2),t.k0s(),t.j41(3,"div",30)(4,"app-editor-board",31),t.bIt("clickBoardEvent",function(){const o=t.eBV(n).$index,a=t.XpG(2);return t.Njj(a.selectLevel(o))}),t.k0s()()()}if(2&i){const n=r.$implicit,e=r.$index,o=t.XpG(2);t.Y8G("ngClass",t.eq3(4,pt,e===o.currentZ)),t.R7$(2),t.SpI("Level ",e,""),t.R7$(2),t.Y8G("level",t.l_i(6,dt,e,n))("matrix",o.matrix)}}function gt(i,r){if(1&i&&(t.j41(0,"div",26),t.qSk(),t.j41(1,"svg",32)(2,"g",33),t.nrm(3,"path",34),t.k0s(),t.j41(4,"text",35),t.EFF(5),t.k0s(),t.j41(6,"text",36),t.EFF(7),t.k0s(),t.j41(8,"text",37),t.EFF(9),t.k0s()()()),2&i){const n=t.XpG(2);t.R7$(5),t.Lme("x",n.stats.minX," \u2026 x",n.stats.maxX,""),t.R7$(2),t.Lme("z",n.stats.minZ," \u2026 z",n.stats.maxZ,""),t.R7$(2),t.Lme("y",n.stats.minY," \u2026 y",n.stats.maxY,"")}}function ht(i,r){if(1&i){const n=t.RV6();t.j41(0,"button",38),t.bIt("click",function(){t.eBV(n);const o=t.XpG(2);return t.Njj(o.solve())}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"EDITOR_TEST_RUN")," "))}function mt(i,r){if(1&i){const n=t.RV6();t.j41(0,"button",38),t.bIt("click",function(){t.eBV(n);const o=t.XpG(2);return t.Njj(o.cancelSolve())}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"EDITOR_TEST_CANCEL")," "))}function Ct(i,r){if(1&i&&(t.j41(0,"div")(1,"div"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div"),t.EFF(5),t.nI1(6,"translate"),t.j41(7,"span"),t.EFF(8),t.k0s()()()),2&i){const n=t.XpG(2);t.R7$(2),t.Lme("",t.bMT(3,6,"EDITOR_TEST_SOLVED"),": ",n.solveStats.won,""),t.R7$(3),t.SpI("",t.bMT(6,8,"EDITOR_TEST_FAILED"),": "),t.R7$(2),t.AVh("fail",n.solveStats.fail>0),t.R7$(),t.JRh(n.solveStats.fail)}}function ft(i,r){if(1&i){const n=t.RV6();t.j41(0,"div",1)(1,"ul",2),t.Z7z(2,ut,5,9,"li",3,t.fX1),t.k0s(),t.j41(4,"div",4)(5,"div",5)(6,"button",6),t.nI1(7,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.newLayerBelow(o.currentZ))}),t.nrm(8,"i",7),t.k0s()()()(),t.j41(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",4)(13,"div",11)(14,"div",12),t.EFF(15),t.k0s(),t.j41(16,"button",13),t.nI1(17,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.moveLayerZ(-1,o.currentZ))}),t.nrm(18,"i",14),t.k0s(),t.j41(19,"button",13),t.nI1(20,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.moveLayerZ(1,o.currentZ))}),t.nrm(21,"i",15),t.k0s(),t.j41(22,"button",6),t.nI1(23,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.duplicateLayerZ(o.currentZ))}),t.nrm(24,"i",16),t.k0s(),t.j41(25,"button",6),t.nI1(26,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.clearLayerZ(o.currentZ))}),t.nrm(27,"i",17),t.k0s(),t.j41(28,"button",6),t.nI1(29,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.deleteLayerZ(o.currentZ))}),t.nrm(30,"i",18),t.k0s()(),t.j41(31,"div",5)(32,"span"),t.EFF(33),t.k0s(),t.j41(34,"button",6),t.nI1(35,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.moveLayerY(-1))}),t.nrm(36,"i",14),t.k0s(),t.j41(37,"button",6),t.nI1(38,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.moveLayerY(1))}),t.nrm(39,"i",15),t.k0s(),t.j41(40,"button",6),t.nI1(41,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.moveLayerX(-1))}),t.nrm(42,"i",19),t.k0s(),t.j41(43,"button",6),t.nI1(44,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.moveLayerX(1))}),t.nrm(45,"i",20),t.k0s()()(),t.j41(46,"div",21)(47,"app-editor-board",22),t.bIt("clickDrawEvent",function(o){t.eBV(n);const a=t.XpG();return t.Njj(a.onCellClick(o))})("clickStoneEvent",function(o){t.eBV(n);const a=t.XpG();return t.Njj(a.onStoneClick(o))}),t.k0s()()(),t.j41(48,"div",23)(49,"div",4)(50,"div",5)(51,"div",12),t.EFF(52),t.nI1(53,"translate"),t.k0s()(),t.j41(54,"div",5)(55,"span"),t.EFF(56),t.k0s(),t.j41(57,"button",6),t.nI1(58,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.moveY(-1))}),t.nrm(59,"i",14),t.k0s(),t.j41(60,"button",6),t.nI1(61,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.moveY(1))}),t.nrm(62,"i",15),t.k0s(),t.j41(63,"button",6),t.nI1(64,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.moveX(-1))}),t.nrm(65,"i",19),t.k0s(),t.j41(66,"button",6),t.nI1(67,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.moveX(1))}),t.nrm(68,"i",20),t.k0s()()(),t.j41(69,"div",24),t.nrm(70,"app-layout-preview",25),t.DNE(71,gt,10,6,"div",26),t.k0s(),t.j41(72,"div",27)(73,"div",5)(74,"div"),t.DNE(75,ht,3,3,"button",28)(76,mt,3,3,"button",28),t.k0s()(),t.DNE(77,Ct,9,10,"div"),t.k0s()()()()}if(2&i){const n=t.XpG();t.R7$(2),t.Dyx(n.matrix.levels),t.R7$(4),t.FS9("title",t.bMT(7,30,"EDITOR_NEW_LAYER_LONG")),t.R7$(9),t.SpI("Level ",n.currentZ,""),t.R7$(),t.FS9("title",t.bMT(17,32,"EDITOR_MOVE_LAYER_DOWN_LONG")),t.Y8G("disabled",0===n.currentZ),t.R7$(3),t.FS9("title",t.bMT(20,34,"EDITOR_MOVE_LAYER_UP_LONG")),t.Y8G("disabled",n.currentZ===n.matrix.levels.length-1),t.R7$(3),t.FS9("title",t.bMT(23,36,"EDITOR_DUPLICATE_LAYER_LONG")),t.R7$(3),t.FS9("title",t.bMT(26,38,"EDITOR_CLEAR_LAYER_LONG")),t.R7$(3),t.FS9("title",t.bMT(29,40,"EDITOR_DELETE_LAYER_LONG")),t.R7$(5),t.SpI("Tiles: ",n.stats.layerCount,""),t.R7$(),t.FS9("title",t.bMT(35,42,"EDITOR_MOVE_TILES_UP_LONG")),t.R7$(3),t.FS9("title",t.bMT(38,44,"EDITOR_MOVE_TILES_DOWN_LONG")),t.R7$(3),t.FS9("title",t.bMT(41,46,"EDITOR_MOVE_TILES_LEFT_LONG")),t.R7$(3),t.FS9("title",t.bMT(44,48,"EDITOR_MOVE_TILES_RIGHT_LONG")),t.R7$(4),t.Y8G("level",n.level)("isBoard",!0)("matrix",n.matrix),t.R7$(5),t.JRh(t.bMT(53,50,"EDITOR_VIEW_FULL")),t.R7$(3),t.AVh("fail",n.stats.countInvalid),t.R7$(),t.SpI("Tiles: ",n.stats.totalCount,""),t.R7$(),t.FS9("title",t.bMT(58,52,"EDITOR_MOVE_ALL_TILES_UP_LONG")),t.R7$(3),t.FS9("title",t.bMT(61,54,"EDITOR_MOVE_ALL_TILES_DOWN_LONG")),t.R7$(3),t.FS9("title",t.bMT(64,56,"EDITOR_MOVE_ALL_TILES_LEFT_LONG")),t.R7$(3),t.FS9("title",t.bMT(67,58,"EDITOR_MOVE_ALL_TILES_RIGHT_LONG")),t.R7$(4),t.Y8G("svg",n.svg),t.R7$(),t.vxM(n.stats?71:-1),t.R7$(4),t.vxM(n.solveWorker?-1:75),t.R7$(),t.vxM(n.solveWorker?76:-1),t.R7$(),t.vxM(n.solveStats?77:-1)}}function Mt(i,r){if(1&i){const n=t.RV6();t.j41(0,"div",39),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.toggleSave())}),t.j41(1,"div",40),t.bIt("click",function(o){return t.eBV(n),t.Njj(o.stopPropagation())}),t.j41(2,"span",41),t.nI1(3,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.toggleSave())}),t.nrm(4,"i",42),t.k0s(),t.j41(5,"app-editor-export-component",43),t.bIt("savedEvent",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.toggleAfterSave())}),t.k0s()()()}if(2&i){const n=t.XpG();t.R7$(2),t.FS9("title",t.bMT(3,2,"CLOSE")),t.R7$(3),t.Y8G("layout",n.layout)}}let V=(()=>{class i{constructor(n,e){this.worker=n,this.layoutService=e,this.currentZ=0,this.totalZ=1,this.totalY=u.fV.mY,this.totalX=u.fV.mX,this.matrix=new f,this.saveDialog=!1,this.hasChanged=!1}ngOnDestroy(){this.cancelSolve()}getStats(n){const e={name:n.name,totalCount:n.mapping.length,layerCount:n.mapping.filter(o=>o[0]===this.currentZ).length,countInvalid:n.mapping.length>144||!!(n.mapping.length%2),minX:100,maxX:0,minY:100,maxY:0,minZ:100,maxZ:0,height:0,width:0,depth:0};return n.mapping.forEach(o=>{o[0]<e.minZ&&(e.minZ=o[0]),o[0]>e.maxZ&&(e.maxZ=o[0]),o[1]<e.minX&&(e.minX=o[1]),o[1]>e.maxX&&(e.maxX=o[1]),o[2]<e.minY&&(e.minY=o[2]),o[2]>e.maxY&&(e.maxY=o[2])}),e.width=e.maxX-e.minX,e.height=e.maxY-e.minY,e.depth=e.maxZ-e.minZ,e}ngOnInit(){this.layout&&(this.refresh(),this.hasChanged=!1)}ngOnChanges(n){n.layout&&(this.refresh(),this.hasChanged=!1)}onPosClick(n,e,o){this.matrix.isTilePosBlocked(n,e,o)||this.matrix.isTilePosInvalid(n,e,o)||(this.matrix.isTile(n,e,o)?this.layout.mapping=this.layout.mapping.filter(a=>a[0]!==n||a[1]!==e||a[2]!==o):this.layout.mapping.push([n,e,o]),this.refresh())}onCellClick(n){this.onPosClick(n.z,n.x,n.y)}onStoneClick(n){n&&this.onPosClick(n.z,n.x,n.y)}selectLevel(n){this.level={z:n,rows:this.matrix.levels[n],showTiles:!0},this.currentZ=n,this.refresh()}refresh(){this.hasChanged=!0,this.matrix.applyMapping(this.layout.mapping,this.totalZ,this.totalX,this.totalY),this.stats=this.getStats(this.layout),this.level={z:this.currentZ,rows:this.matrix.levels[this.currentZ],showTiles:!0},this.svg=this.layoutService.generatePreview(y(this.layout.mapping)),this.layout.previewSVG=this.svg}moveX(n){this.stats.minX+n<0||this.stats.maxX+n>=u.fV.mX-1||(this.layout.mapping.forEach(e=>e[1]=e[1]+n),this.refresh())}moveY(n){this.stats.minY+n<0||this.stats.maxY+n>=u.fV.mY-1||(this.layout.mapping.forEach(e=>e[2]=e[2]+n),this.refresh())}moveLayerX(n){const e=this.layout.mapping.filter(s=>s[0]===this.currentZ);let o=e[0][1],a=e[0][1];e.forEach(s=>{o=Math.min(s[1],o),a=Math.max(s[1],a)}),!(o+n<0||a+n>=u.fV.mX-1)&&(e.forEach(s=>s[1]=s[1]+n),this.refresh())}moveLayerY(n){const e=this.layout.mapping.filter(s=>s[0]===this.currentZ);let o=e[0][2],a=e[0][2];e.forEach(s=>{o=Math.min(s[2],o),a=Math.max(s[2],a)}),!(o+n<0||a+n>=u.fV.mY-1)&&(e.forEach(s=>s[2]=s[2]+n),this.refresh())}duplicateLayerZ(n){const e=[];this.layout.mapping.forEach(o=>{o[0]>n?o[0]=o[0]+1:o[0]===n&&e.push(o)}),e.forEach(o=>{this.layout.mapping.push([n+1,o[1],o[2]])}),this.refresh()}clearLayerZ(n){this.layout.mapping=this.layout.mapping.filter(e=>e[0]!==n),this.refresh()}deleteLayerZ(n){this.layout.mapping=this.layout.mapping.filter(e=>e[0]!==n),this.layout.mapping.forEach(e=>{e[0]>n&&(e[0]=e[0]-1)}),this.totalZ=Math.max(this.totalZ-1,1),this.refresh()}newLayerBelow(n){this.totalZ+=1,this.layout.mapping.forEach(e=>{e[0]>n&&(e[0]=e[0]+1)}),this.refresh()}moveLayerZ(n,e){e+n<0||e+n>=this.matrix.levels.length||(this.layout.mapping.forEach(o=>{o[0]===e?o[0]=o[0]+n:o[0]===e+n&&(o[0]=e)}),e===this.currentZ&&(this.currentZ=this.currentZ+n),this.refresh())}toggleSave(){this.saveDialog=!this.saveDialog}toggleAfterSave(){this.saveDialog=!1,this.hasChanged=!1}cancelSolve(){this.solveWorker&&(this.solveWorker.terminate(),this.solveWorker=void 0)}solve(){if(this.solveWorker)return;const n={fail:0,won:0};this.solveWorker=this.worker.solve(this.layout.mapping,1e3,e=>{n.won=e[0],n.fail=e[1]},e=>{n.won=e[0],n.fail=e[1],this.solveWorker=void 0}),this.solveStats=n}static#t=this.\u0275fac=function(e){return new(e||i)(t.rXU(R.S),t.rXU(m.Y))};static#n=this.\u0275cmp=t.VBU({type:i,selectors:[["app-editor-layout-component"]],inputs:{layout:"layout"},features:[t.OA$],decls:2,vars:2,consts:[[1,"overlay","overlay-save"],[1,"editor-matrix-list"],[1,"matrix-list"],[3,"ngClass"],[1,"buttonbar"],[1,"buttons"],[3,"click","title"],[1,"icon-editor-list-add"],[1,"editor-selected"],[1,"matrix-edit"],[1,"matrix-edit-top"],[1,"buttons","buttons-current-level"],[1,"buttonbar-title"],[3,"click","disabled","title"],[1,"icon-editor-up-small"],[1,"icon-editor-down-small"],[1,"icon-editor-docs"],[1,"icon-editor-cancel-alt"],[1,"icon-editor-trash"],[1,"icon-editor-left-small"],[1,"icon-editor-right-small"],[1,"matrix-board"],[3,"clickDrawEvent","clickStoneEvent","level","isBoard","matrix"],[1,"matrix-edit-bottom"],[1,"matrix-preview"],[1,"svg-board",3,"svg"],[1,"dimensions"],[1,"stats","stats-bottom"],[1,"text-button"],[3,"click","ngClass"],[1,"matrix-level"],[3,"clickBoardEvent","level","matrix"],["xmlns","http://www.w3.org/2000/svg","height","100%","width","100%","x","0px","y","0px","viewBox","0 0 1600 1500"],["transform","translate(0, 300)"],["fill","#47b00a","d","M10,309.7c40.7-99.4,81.5-198.7,122.3-298c39.6,99.2,78.6,198.7,117.9,298c-31.6,0.1-63.2,0-94.8,0.1c0,167-0.1,334.1,0,501.1c148.5-103.4,296.4-207.8,444.8-311.4c-16.9-26.8-37-51.7-53.8-78.5c102.1-22.8,204.1-46,306.2-69C795.4,439.2,738,526.3,680.3,613.2c-17.6-25.2-35.1-50.4-52.9-75.4C480.9,640,334.5,742.4,188.5,845.4c167.8,0.3,335.6,0.1,503.4,0.1c0.1-32.5-0.1-64.9,0.1-97.3c99.4,40.7,198.7,81.5,298,122.3C890.8,910,791.3,949,691.9,988.3c-0.1-31.6,0-63.2-0.1-94.8c-193.7-0.1-387.4-0.1-581.1,0c-1.2,0-2.3-0.5-3.5-0.8c0.1-194.3,0.1-388.6,0-582.9C74.9,309.7,42.5,309.8,10,309.7L10,309.7z"],["x","100","y","1500","fill","#47b00a",2,"font","200px monospace"],["x","0","y","200","fill","#47b00a",2,"font","200px monospace"],["x","600","y","500","fill","#47b00a",2,"font","200px monospace"],[1,"text-button",3,"click"],[1,"overlay","overlay-save",3,"click"],[1,"overlay-popup",3,"click"],[1,"close",3,"click","title"],[1,"icon-cancel-circled2"],[3,"savedEvent","layout"]],template:function(e,o){1&e&&t.DNE(0,ft,78,60)(1,Mt,6,4,"div",0),2&e&&(t.vxM(o.layout?0:-1),t.R7$(),t.vxM(o.saveDialog?1:-1))},dependencies:[I.YU,T.M,q,_t,g.D9],styles:["[_nghost-%COMP%]{display:flex;flex:1;flex-direction:row;color:var(--main-text-color);overflow:hidden}[_nghost-%COMP%]   .save-button[_ngcontent-%COMP%]{position:fixed;right:50px;top:6px}[_nghost-%COMP%]   .overlay-save[_ngcontent-%COMP%]   .overlay-popup[_ngcontent-%COMP%]{width:98%;height:98%;max-height:640px;max-width:640px;overflow-y:auto}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{padding-right:6px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   .fail[_ngcontent-%COMP%]{color:var(--text-fail-color)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;background-image:none;color:var(--text-highlight-color);border:1px solid var(--main-bg-color-dk);cursor:pointer}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--main-text-color-hover);border:1px solid var(--main-bg-color-lt)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button.text-button[_ngcontent-%COMP%]{padding:10px 16px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{color:var(--text-disabled-color);cursor:default}[_nghost-%COMP%]   .buttons-current-level[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .buttonbar[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}[_nghost-%COMP%]   .buttonbar[_ngcontent-%COMP%]   .buttonbar-title[_ngcontent-%COMP%]{padding-left:12px;padding-right:12px}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]{width:220px;max-height:100%;height:100%;border-right:1px solid var(--dialog-border-color);overflow-y:auto;background-color:var(--editor-color-bg)}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:4px;max-height:100%}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   .matrix-level[_ngcontent-%COMP%]{display:flex;max-width:80%;margin:0 auto}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{text-align:center;cursor:pointer;border:1px solid var(--dialog-border-color);margin-bottom:4px;display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{border-color:var(--dialog-border-color-hover)}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]{border-color:var(--dialog-border-color-selected)}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;display:inline-block;min-width:.8em}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:auto}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .editor-commands[_ngcontent-%COMP%]{border-bottom:1px solid #ececec;padding-bottom:10px}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .editor-commands[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{font-size:.9em;display:inline-block;vertical-align:top;margin-right:10px}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .editor-commands[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer;text-decoration:underline;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;text-align:center;max-height:100%;overflow:hidden}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-top[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow:hidden}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-top[_ngcontent-%COMP%]   .matrix-board[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]{border-top:1px solid var(--dialog-border-color);height:25%;display:flex;flex-direction:column;position:relative;min-height:120px}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .matrix-preview[_ngcontent-%COMP%]{position:relative;overflow:hidden}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .matrix-preview[_ngcontent-%COMP%]   .dimensions[_ngcontent-%COMP%]{opacity:0;background-color:#000000b3;position:absolute;padding:8px;inset:0}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .matrix-preview[_ngcontent-%COMP%]:hover   .dimensions[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]{position:absolute;background-color:#000000b3;bottom:0;font-size:.9em;border-radius:6px;text-align:left;padding:10px;font-variant-numeric:slashed-zero tabular-nums}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .stats-bottom[_ngcontent-%COMP%]{text-align:right;right:0}@media only screen and (max-width: 700px){[_nghost-%COMP%]{flex-direction:column}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]{height:80px;width:100%;overflow:auto hidden;margin-bottom:2px;border-right:none;border-bottom:1px solid var(--dialog-border-color)}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]{white-space:nowrap;border-right:none;height:92%}[_nghost-%COMP%]   .editor-matrix-list[_ngcontent-%COMP%]   .matrix-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{width:100px;height:100%;display:inline-flex}}@media only screen and (width >= 400px) and (height <= 600px){[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]{flex-direction:row}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-top[_ngcontent-%COMP%]{max-height:100%}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]{height:100%;width:30%;border-top:none}[_nghost-%COMP%]   .editor-selected[_ngcontent-%COMP%]   .matrix-edit[_ngcontent-%COMP%]   .matrix-edit-bottom[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block}}"]})}return i})();function Ot(i,r){if(1&i&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i){const n=t.XpG(2).$implicit,e=t.XpG();t.R7$(),t.Lme("",t.bMT(2,2,"EDITOR_TEST_SOLVED"),": ",null==e.test[n.id]?null:e.test[n.id].win,"")}}function vt(i,r){if(1&i&&(t.j41(0,"div",20),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i){const n=t.XpG(2).$implicit,e=t.XpG();t.R7$(),t.Lme("",t.bMT(2,2,"EDITOR_TEST_FAILED"),": ",null==e.test[n.id]?null:e.test[n.id].fail,"")}}function bt(i,r){if(1&i&&(t.j41(0,"div"),t.DNE(1,Ot,3,4,"div")(2,vt,3,4,"div",20),t.k0s()),2&i){const n=t.XpG().$implicit,e=t.XpG();t.R7$(),t.vxM(null!=e.test[n.id]&&e.test[n.id].win?1:-1),t.R7$(),t.vxM(null!=e.test[n.id]&&e.test[n.id].fail?2:-1)}}function xt(i,r){if(1&i){const n=t.RV6();t.j41(0,"button",9),t.nI1(1,"translate"),t.bIt("click",function(o){t.eBV(n);const a=t.XpG().$implicit,s=t.XpG();return t.Njj(s.removeCustomBoard(o,a))}),t.nrm(2,"i",12),t.k0s()}2&i&&t.FS9("title",t.bMT(1,1,"CUSTOM_BOARD_DELETE"))}function Pt(i,r){if(1&i){const n=t.RV6();t.j41(0,"tr",14),t.bIt("click",function(){const o=t.eBV(n).$implicit,a=t.XpG();return t.Njj(a.editLayout(o))}),t.j41(1,"td",2),t.nrm(2,"app-layout-preview",15),t.k0s(),t.j41(3,"td",16),t.EFF(4),t.k0s(),t.j41(5,"td",17),t.EFF(6),t.k0s(),t.j41(7,"td",18),t.EFF(8),t.k0s(),t.j41(9,"td",8)(10,"button",9),t.nI1(11,"translate"),t.bIt("click",function(o){const a=t.eBV(n).$implicit,s=t.XpG();return t.Njj(s.testLayout(o,a))}),t.nrm(12,"i",10),t.k0s(),t.DNE(13,bt,3,2,"div"),t.k0s(),t.j41(14,"td",11),t.DNE(15,xt,3,3,"button",19),t.k0s()()}if(2&i){const n=r.$implicit,e=t.XpG();t.R7$(2),t.Y8G("layout",n),t.R7$(2),t.JRh(n.name),t.R7$(2),t.JRh(n.category),t.R7$(2),t.JRh(n.mapping.length),t.R7$(2),t.FS9("title",t.bMT(11,7,"EDITOR_TEST_RUN")),t.R7$(3),t.vxM(e.test[n.id]?13:-1),t.R7$(2),t.vxM(n.custom?15:-1)}}let yt=(()=>{class i{constructor(n,e){this.layoutService=n,this.workerService=e,this.test={},this.sortColumn=1,this.sortDesc=!0,this.showBuildIn=!0,this.editEvent=new t.bkB,this.update()}ngOnChanges(n){n.inputLayouts&&this.update()}ngOnDestroy(){this.worker&&(this.worker.terminate(),this.worker=void 0)}editLayout(n){this.editEvent.emit(n)}toggleBuildIn(){this.showBuildIn=!this.showBuildIn,this.update()}clickSortBy(n,e){this.sortColumn===e&&(this.sortDesc=!this.sortDesc),this.sortBy(e)}update(){this.inputLayouts&&(this.layouts=this.inputLayouts.sort((n,e)=>n.name.localeCompare(e.name)),this.showBuildIn||(this.layouts=this.layouts.filter(n=>n.custom)),this.sortBy(this.sortColumn))}removeCustomBoard(n,e){n.stopPropagation(),this.layoutService.removeCustomLayout([e.id]),this.update()}removeCustomLayouts(n){n.stopPropagation(),this.layoutService.removeAllCustomLayouts(),this.update()}sortBy(n){this.sortColumn=n,this.layouts=this.layouts.sort((e,o)=>{let a;switch(n){case 1:a=e.name.localeCompare(o.name);break;case 2:a=(e.by||"").localeCompare(o.by||"");break;case 3:a=(e.category||"").localeCompare(o.category||"");break;case 4:a=e.mapping.length-o.mapping.length;break;default:a=0}return(this.sortDesc?1:-1)*a})}testLayout(n,e){n.stopPropagation(),this.startTestLayout(e)}startTestLayout(n,e){if(this.worker)return this.worker.terminate(),void(this.worker=void 0);this.test[n.id]=void 0,this.worker=this.workerService.solve(n.mapping,10,o=>{this.test[n.id]={win:o[0],fail:o[1]}},o=>{this.test[n.id]={win:o[0],fail:o[1]},this.worker=void 0,e&&e()})}testLayouts(n){this.worker?this.worker.terminate():this.testNextLayout()}testNextLayout(){const n=this.layouts.find(e=>!this.test[e.id]);n&&this.startTestLayout(n,()=>{this.testNextLayout()})}static#t=this.\u0275fac=function(e){return new(e||i)(t.rXU(m.Y),t.rXU(R.S))};static#n=this.\u0275cmp=t.VBU({type:i,selectors:[["app-manager-component"]],inputs:{inputLayouts:"inputLayouts"},outputs:{editEvent:"editEvent"},features:[t.OA$],decls:36,vars:37,consts:[[1,"layout-table"],[1,"layout","layout-header"],[1,"col-image"],[1,"col-name","sortable",3,"click"],[1,"arrow"],[1,"col-cat","sortable",3,"click"],["type","checkbox",3,"change","checked"],[1,"col-stats","sortable",3,"click"],[1,"col-test"],[3,"click","title"],[1,"icon-editor-paper-plane-empty"],[1,"col-delete"],[1,"icon-trash-empty"],[1,"layout"],[1,"layout",3,"click"],[1,"svg-board",3,"layout"],[1,"col-name"],[1,"col-cat"],[1,"col-stats"],[3,"title"],[1,"fail"]],template:function(e,o){1&e&&(t.j41(0,"table",0)(1,"thead")(2,"tr",1)(3,"td",2),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"td",3),t.bIt("click",function(s){return o.clickSortBy(s,1)}),t.EFF(7),t.nI1(8,"translate"),t.nrm(9,"span",4),t.k0s(),t.j41(10,"td",5),t.bIt("click",function(s){return o.clickSortBy(s,3)}),t.EFF(11),t.nI1(12,"translate"),t.nrm(13,"span",4),t.j41(14,"div")(15,"label")(16,"input",6),t.bIt("change",function(){return o.toggleBuildIn()}),t.k0s(),t.EFF(17),t.nI1(18,"translate"),t.k0s()()(),t.j41(19,"td",7),t.bIt("click",function(s){return o.clickSortBy(s,4)}),t.EFF(20),t.nI1(21,"translate"),t.nrm(22,"span",4),t.k0s(),t.j41(23,"td",8),t.EFF(24),t.nI1(25,"translate"),t.j41(26,"button",9),t.nI1(27,"translate"),t.bIt("click",function(s){return o.testLayouts(s)}),t.nrm(28,"i",10),t.k0s()(),t.j41(29,"td",11)(30,"button",9),t.nI1(31,"translate"),t.bIt("click",function(s){return o.removeCustomLayouts(s)}),t.nrm(32,"i",12),t.k0s()()()(),t.j41(33,"tbody"),t.Z7z(34,Pt,16,9,"tr",13,t.fX1),t.k0s()()),2&e&&(t.R7$(4),t.JRh(t.bMT(5,21,"EDITOR_COLUMN_PREVIEW")),t.R7$(2),t.AVh("sort-up",1===o.sortColumn&&o.sortDesc)("sort-down",1===o.sortColumn&&!o.sortDesc),t.R7$(),t.SpI("",t.bMT(8,23,"EDITOR_LAYOUT_NAME")," "),t.R7$(3),t.AVh("sort-up",3===o.sortColumn&&o.sortDesc)("sort-down",3===o.sortColumn&&!o.sortDesc),t.R7$(),t.SpI("",t.bMT(12,25,"EDITOR_LAYOUT_CATEGORY")," "),t.R7$(5),t.Y8G("checked",o.showBuildIn),t.R7$(),t.SpI(" ",t.bMT(18,27,"EDITOR_SHOW_BUILDIN")," "),t.R7$(2),t.AVh("sort-up",4===o.sortColumn&&o.sortDesc)("sort-down",4===o.sortColumn&&!o.sortDesc),t.R7$(),t.SpI("",t.bMT(21,29,"EDITOR_LAYOUT_NR_OF_STONES")," "),t.R7$(4),t.SpI("",t.bMT(25,31,"EDITOR_COLUMN_TEST")," "),t.R7$(2),t.FS9("title",t.bMT(27,33,"EDITOR_TEST_RUN")),t.R7$(4),t.FS9("title",t.bMT(31,35,"CUSTOM_BOARD_DELETE_ALL")),t.R7$(4),t.Dyx(o.layouts))},dependencies:[T.M,g.D9],styles:["[_nghost-%COMP%]{overflow-y:auto;flex:1}[_nghost-%COMP%]   .fail[_ngcontent-%COMP%]{color:var(--text-fail-color)}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]{color:var(--editor-table-row-color);width:100%}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%]{cursor:pointer;background-color:var(--editor-table-row-color-bg);height:80px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%]:hover{background-color:var(--editor-table-row-color-bg-hover)}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{vertical-align:middle;padding:4px 15px;border-top:1px solid var(--dialog-border-color);border-right:1px solid var(--dialog-border-color)}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-bottom:5px solid var(--main-text-color);display:none;margin-bottom:3px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%] > div.sortable[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%] > div.sort-up[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%] > div.sort-down[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{display:inline-block;transform:rotate(180deg)}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%]   .col-image[_ngcontent-%COMP%]{width:80px;height:80px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout[_ngcontent-%COMP%]   .col-id[_ngcontent-%COMP%]{font-variant-numeric:slashed-zero tabular-nums}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .col-test[_ngcontent-%COMP%]{width:140px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .col-cat[_ngcontent-%COMP%]{width:200px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .col-stats[_ngcontent-%COMP%]{width:140px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .col-delete[_ngcontent-%COMP%]{width:80px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout-header[_ngcontent-%COMP%]{max-height:30px}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout-header[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border-top:none}[_nghost-%COMP%]   .layout-table[_ngcontent-%COMP%]   .layout-header[_ngcontent-%COMP%]:hover{background-color:#0000001a}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;background-image:none;color:var(--text-highlight-color);border:1px solid var(--main-bg-color-dk);cursor:pointer;text-align:center}[_nghost-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--main-text-color-hover);border:1px solid var(--main-bg-color-lt)}[_nghost-%COMP%]   button.text-button[_ngcontent-%COMP%]{padding:10px 16px}[_nghost-%COMP%]   button[disabled][_ngcontent-%COMP%]{color:var(--text-disabled-color);cursor:default}"]})}return i})(),X=(()=>{class i{constructor(){this.appDropZone=new t.bkB,this.appDropZoneOver=new t.bkB,this.preventBodyDrop=!0,this.active=!1}onDrop(n){n.preventDefault(),this.active=!1;const{dataTransfer:e}=n;if(e?.items){const o=[];for(let a=0;a<e.items.length;a++)if(e.items[a]&&"file"===e.items[a].kind){const s=e.items[a].getAsFile();null!=s&&o.push(s)}e.items.clear(),this.appDropZone.emit(o)}else if(e){const o=e?.files;e.clearData(),o&&this.appDropZone.emit(Array.from(o))}}onDragOver(n){n.stopPropagation(),n.preventDefault(),this.active||this.appDropZoneOver.emit(),this.active=!0}onDragLeave(n){this.active=!1}onBodyDragOver(n){this.preventBodyDrop&&(n.preventDefault(),n.stopPropagation())}onBodyDrop(n){this.preventBodyDrop&&n.preventDefault()}static#t=this.\u0275fac=function(e){return new(e||i)};static#n=this.\u0275dir=t.FsC({type:i,selectors:[["","appDropZone",""]],hostVars:2,hostBindings:function(e,o){1&e&&t.bIt("drop",function(s){return o.onDrop(s)})("dragover",function(s){return o.onDragOver(s)})("dragleave",function(s){return o.onDragLeave(s)})("dragover",function(s){return o.onBodyDragOver(s)},!1,t.N_X)("drop",function(s){return o.onBodyDrop(s)},!1,t.N_X),2&e&&t.AVh("drop-zone-active",o.active)},inputs:{preventBodyDrop:"preventBodyDrop"},outputs:{appDropZone:"appDropZone",appDropZoneOver:"appDropZoneOver"}})}return i})();function kt(i,r){if(1&i){const n=t.RV6();t.j41(0,"a",7),t.bIt("click",function(){t.eBV(n);const o=t.XpG().$implicit,a=t.XpG();return t.Njj(a.selectLayout(o.id))}),t.nrm(1,"i",8),t.EFF(2),t.k0s()}if(2&i){const n=t.XpG().$implicit;t.R7$(2),t.SpI(" ",n.msg,"")}}function Et(i,r){if(1&i&&t.EFF(0),2&i){const n=t.XpG().$implicit;t.SpI(" ",n.msg," ")}}function Tt(i,r){if(1&i&&(t.j41(0,"p",6),t.DNE(1,kt,3,1,"a")(2,Et,1,1),t.k0s()),2&i){const n=r.$implicit;t.AVh("is-error",n.isError),t.R7$(),t.vxM(n.id?1:-1),t.R7$(),t.vxM(n.id?-1:2)}}let wt=(()=>{class i{constructor(n){this.layoutService=n,this.editEvent=new t.bkB,this.logs=[]}selectFiles(n){const o=n.currentTarget.files;o&&this.importFiles(Array.from(o))}importLayouts(n){var e=this;return(0,h.A)(function*(){e.logs=[];const o=[];for(const a of n)try{(yield J(a)).forEach(c=>{const l=e.layoutService.expandLayout(c,!0);e.layoutService.layouts.items.find(_=>_.id===l.id)||o.find(_=>_.id===l.id)?(console.error(`Similar layout to "${l.name}" already available. Import rejected`),e.logs.push({msg:`Similar layout to "${l.name}" already available. Import rejected.`,isError:!0})):(o.push(m.Y.layout2loadLayout(l,c.map)),e.logs.push({msg:`Imported: "${a.name}"`,id:l.id}))})}catch(s){console.error("Error importing",a,s),e.logs.push({msg:`ERROR importing "${a.name}". Invalid file.`,isError:!0})}o.length>0&&e.layoutService.storeCustomBoards(o)})()}selectLayout(n){const e=this.layoutService.layouts.items.find(o=>o.id===n);e&&this.editEvent.emit(e)}importFiles(n){this.importLayouts(n).catch(e=>{console.error(e)})}onDropFiles(n){this.importFiles(n)}static#t=this.\u0275fac=function(e){return new(e||i)(t.rXU(m.Y))};static#n=this.\u0275cmp=t.VBU({type:i,selectors:[["app-import-component"]],outputs:{editEvent:"editEvent"},decls:19,vars:12,consts:[[1,"import-section",3,"appDropZone"],[1,"drop-zone"],[1,"title"],["name","file","type","file","multiple","",3,"change"],[1,"log-zone"],[1,"layout",3,"is-error"],[1,"layout"],[3,"click"],[1,"icon-editor-ok"]],template:function(e,o){1&e&&(t.j41(0,"div",0),t.bIt("appDropZone",function(s){return o.onDropFiles(s)}),t.j41(1,"div",1)(2,"div",2),t.EFF(3),t.nI1(4,"translate"),t.nrm(5,"br"),t.EFF(6),t.nI1(7,"translate"),t.nrm(8,"br"),t.EFF(9),t.nI1(10,"translate"),t.nrm(11,"br"),t.EFF(12),t.nI1(13,"translate"),t.nrm(14,"br"),t.k0s(),t.j41(15,"input",3),t.bIt("change",function(s){return o.selectFiles(s)}),t.k0s()(),t.j41(16,"div",4),t.Z7z(17,Tt,3,4,"p",5,t.fX1),t.k0s()()),2&e&&(t.R7$(3),t.JRh(t.bMT(4,4,"EDITOR_IMPORT_DROP")),t.R7$(3),t.SpI(" ",t.bMT(7,6,"EDITOR_FORMAT_KYODAI"),""),t.R7$(3),t.SpI(" ",t.bMT(10,8,"EDITOR_FORMAT_KMAHJONGG"),""),t.R7$(3),t.SpI(" ",t.bMT(13,10,"EDITOR_FORMAT_MAH"),""),t.R7$(5),t.Dyx(o.logs))},dependencies:[X,g.D9],styles:["[_nghost-%COMP%]{flex:1;display:flex;color:var(--main-text-color);width:100%}[_nghost-%COMP%]   .import-section[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;flex-direction:column;width:100%}[_nghost-%COMP%]   .import-section[_ngcontent-%COMP%]   .drop-zone[_ngcontent-%COMP%]{padding:80px 30px;width:100%;max-width:800px;border:2px dashed var(--dialog-border-color);border-radius:20px;text-align:center;position:relative}[_nghost-%COMP%]   .import-section[_ngcontent-%COMP%]   .log-zone[_ngcontent-%COMP%]{margin-top:20px;max-height:300px;width:100%;max-width:800px;color:var(--main-text-color);overflow-y:auto}[_nghost-%COMP%]   .import-section[_ngcontent-%COMP%]   .log-zone[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .import-section[_ngcontent-%COMP%]   .log-zone[_ngcontent-%COMP%]   p.is-error[_ngcontent-%COMP%]{color:var(--text-fail-color)}[_nghost-%COMP%]   .import-section.drop-zone-active[_ngcontent-%COMP%]   .drop-zone[_ngcontent-%COMP%]{border:2px dashed var(--dialog-border-color)}"]})}return i})();function It(i,r){if(1&i){const n=t.RV6();t.j41(0,"div")(1,"div",9)(2,"ul")(3,"li"),t.EFF(4),t.nI1(5,"translate"),t.nI1(6,"translate"),t.k0s()()(),t.j41(7,"div",10)(8,"app-import-component",11),t.bIt("editEvent",function(o){t.eBV(n);const a=t.XpG();return t.Njj(a.editLayout(o))}),t.k0s()()()}2&i&&(t.R7$(4),t.Lme("",t.bMT(5,2,"EDITOR_TITLE"),": ",t.bMT(6,4,"EDITOR_IMPORT"),""))}function Rt(i,r){if(1&i){const n=t.RV6();t.j41(0,"div")(1,"div",4)(2,"ul")(3,"li"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.nrm(6,"li",5),t.j41(7,"li")(8,"button",6),t.nI1(9,"translate"),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.save())}),t.EFF(10),t.nI1(11,"translate"),t.k0s()()()(),t.j41(12,"div",10),t.nrm(13,"app-editor-layout-component",12),t.k0s()()}if(2&i){const n=t.XpG();t.R7$(4),t.Lme("",t.bMT(5,5,"EDITOR_TITLE"),": ",n.layout.name,""),t.R7$(4),t.FS9("title",t.bMT(9,7,"EDITOR_SAVE_LONG")),t.R7$(2),t.JRh(t.bMT(11,9,"EDITOR_SAVE")),t.R7$(3),t.Y8G("layout",n.layout)}}let jt=(()=>{class i{constructor(n,e){this.layoutService=n,this.translate=e,this.mode="manager",this.closeEvent=new t.bkB}save(){this.layoutComponent&&this.layoutComponent.toggleSave()}close(){"manager"!==this.mode?(!(this.layout&&this.layoutComponent&&this.layoutComponent.hasChanged)||confirm(this.translate.instant("EDITOR_DISCARD_CHANGES_SURE")))&&(this.layout=void 0,this.mode="manager"):this.closeEvent.emit()}editLayout(n){this.mode="edit",this.layout={id:"",originalId:n.id,name:n.name,by:n.by||"",category:(n.custom?n.category:void 0)||"Custom",mapping:n.mapping.map(e=>[e[0],e[1],e[2]])}}exportLayouts(){!function at(i){G("mah-layouts.mah",B(i),"text/json")}(this.layoutService.layouts.items)}newLayout(){this.editLayout({id:"",name:"New Board",category:"Custom",by:"",mapping:[]})}onDropFiles(){}onDragFiles(){this.mode="import"}static#t=this.\u0275fac=function(e){return new(e||i)(t.rXU(m.Y),t.rXU(g.c$))};static#n=this.\u0275cmp=t.VBU({type:i,selectors:[["app-editor-component"]],viewQuery:function(e,o){if(1&e&&t.GBs(V,5),2&e){let a;t.mGM(a=t.lsd())&&(o.layoutComponent=a.first)}},outputs:{closeEvent:"closeEvent"},decls:30,vars:29,consts:[[1,"editor-content"],[1,"close",3,"click","title"],[1,"icon-cancel-circled2"],[1,"editor-manager"],[1,"editor-nav","buttons"],[1,"sep"],[3,"click","title"],[1,"editor-main",3,"appDropZone","appDropZoneOver"],[3,"editEvent","inputLayouts"],[1,"editor-nav"],[1,"editor-main"],[3,"editEvent"],[3,"layout"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"a",1),t.nI1(2,"translate"),t.bIt("click",function(){return o.close()}),t.nrm(3,"i",2),t.k0s(),t.j41(4,"div",3)(5,"div",4)(6,"ul")(7,"li"),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.nrm(10,"li",5),t.j41(11,"li")(12,"button",6),t.nI1(13,"translate"),t.bIt("click",function(){return o.newLayout()}),t.EFF(14),t.nI1(15,"translate"),t.k0s()(),t.j41(16,"li")(17,"button",6),t.nI1(18,"translate"),t.bIt("click",function(){return o.mode="import"}),t.EFF(19),t.nI1(20,"translate"),t.k0s()(),t.j41(21,"li")(22,"button",6),t.nI1(23,"translate"),t.bIt("click",function(){return o.exportLayouts()}),t.EFF(24),t.nI1(25,"translate"),t.k0s()()()(),t.j41(26,"div",7),t.bIt("appDropZone",function(){return o.onDropFiles()})("appDropZoneOver",function(){return o.onDragFiles()}),t.j41(27,"app-manager-component",8),t.bIt("editEvent",function(s){return o.editLayout(s)}),t.k0s()()(),t.DNE(28,It,9,6,"div")(29,Rt,14,11,"div"),t.k0s()),2&e&&(t.R7$(),t.FS9("title",t.bMT(2,13,"CLOSE")),t.R7$(3),t.AVh("visible","manager"===o.mode),t.R7$(4),t.JRh(t.bMT(9,15,"EDITOR_TITLE")),t.R7$(4),t.FS9("title",t.bMT(13,17,"EDITOR_NEW_LONG")),t.R7$(2),t.JRh(t.bMT(15,19,"EDITOR_NEW")),t.R7$(3),t.FS9("title",t.bMT(18,21,"EDITOR_IMPORT_LONG")),t.R7$(2),t.JRh(t.bMT(20,23,"EDITOR_IMPORT")),t.R7$(3),t.FS9("title",t.bMT(23,25,"EDITOR_EXPORT_LONG")),t.R7$(2),t.JRh(t.bMT(25,27,"EDITOR_EXPORT")),t.R7$(3),t.Y8G("inputLayouts",o.layoutService.layouts.items),t.R7$(),t.vxM("import"===o.mode?28:-1),t.R7$(),t.vxM("edit"===o.mode&&o.layout?29:-1))},dependencies:[V,yt,wt,X,g.D9],styles:["[_nghost-%COMP%]{--editor-table-row-color: #fff;--editor-color-bg: #1e2e37;--editor-table-row-color-bg: #1e2e37;--editor-table-row-color-bg-hover: #2b424f;position:absolute;inset:0;background-color:var(--editor-color-bg);z-index:10001}[_nghost-%COMP%]   a[_ngcontent-%COMP%]{color:var(--main-content-link-color);cursor:pointer}[_nghost-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--main-content-link-hover-color)}[_nghost-%COMP%]   .close[_ngcontent-%COMP%]{position:absolute;right:10px;top:8px;cursor:pointer}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;background-image:none;border:1px solid var(--main-bg-color-dk);cursor:pointer;font-size:1em;color:var(--text-highlight-color);padding:2px 16px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--main-text-color-hover);border:1px solid var(--main-text-color-hover)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{color:var(--text-disabled-color);cursor:default}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-manager[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-manager.visible[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-nav[_ngcontent-%COMP%]{padding:4px 8px 8px;border-bottom:1px solid var(--dialog-border-color)}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:0;margin:0 40px 0 0;list-style:none;display:flex}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;padding-left:8px}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.sep[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{color:#ff0;cursor:default}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .editor-wrapper[_ngcontent-%COMP%]{text-align:center;width:100%;max-width:800px}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .editor-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:30px;padding:10px}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .layout-selects[_ngcontent-%COMP%]{height:430px;max-width:800px;margin-top:20px;display:flex}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .layout-list[_ngcontent-%COMP%]{border:1px solid var(--dialog-border-color);border-radius:6px;text-align:left;width:50%;overflow-y:hidden;color:var(--main-text-color);display:flex;flex-direction:column}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .layout-list[_ngcontent-%COMP%]   .by[_ngcontent-%COMP%]{font-size:.7em}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .layout-list[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border-bottom:1px solid var(--dialog-border-color);padding:4px 8px;display:flex}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .layout-list[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .layout-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{flex:1;margin:0;padding:0;overflow-y:auto}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .layout-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:var(--main-text-color);padding:4px;border-bottom:1px solid var(--dialog-border-color);cursor:pointer}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .layout-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#ffffff0d}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .layout-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{float:right}[_nghost-%COMP%]   .editor-content[_ngcontent-%COMP%]   .editor-main[_ngcontent-%COMP%]   .editor-select[_ngcontent-%COMP%]   .layout-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .svg-board[_ngcontent-%COMP%]{height:30px;width:40px;margin-right:6px;display:inline-block;vertical-align:middle}"]})}return i})(),Lt=(()=>{class i{static getEditorComponentComponent(){return jt}static#t=this.\u0275fac=function(e){return new(e||i)};static#n=this.\u0275mod=t.$C({type:i});static#e=this.\u0275inj=t.G2t({imports:[I.MD,A.U,g.h]})}return i})()}}]);