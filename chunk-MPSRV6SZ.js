import{A,D as m,E as R,G as E,g as D,h as O,i as K,j as L,l,n,o as N,q as _,s as M,x as S,y as T,z as G}from"./chunk-JDE2M4PC.js";import{b as v,u as x,wb as I,y as j}from"./chunk-4UN4TNNB.js";var $={en:{title:"English"},de:{title:"Deutsch"},nl:{title:"Nederlands"},pt:{title:"Portugu\xEAs"},ru:{title:"\u0440\u0443\u0441\u0441\u043A\u0438\u0439"},es:{title:"Espa\xF1ol"},eu:{title:"Euskara"},jp:{title:"\u65E5\u672C\u8A9E"},fr:{title:"Fran\xE7ais"},zh:{title:"\u4E2D\u6587"}};var p=class{constructor(){this.free=[],this.stones=[],this.count=0,this.hints={groups:[],current:void 0},this.selected=void 0,this.undo=[]}clearSelection(){this.selected&&(this.selected.selected=!1),this.selected=void 0}setStoneSelected(t){this.clearSelection(),t&&(t.selected=!0,this.selected=t)}clearHints(){if(this.hints.current)for(let t of this.hints.current.stones)t.hinted=!1;this.hints={groups:[],current:void 0}}hint(){if(this.hintNext()||(this.clearHints(),this.free.length===0))return;let t=this.collectHints();if(this.selected){let s=this.selected.groupNr;t.sort((i,h)=>i.group===s?-1:h.group===s?1:0)}let e=t[0];this.hints={groups:t,current:e};for(let s of e.stones)s.hinted=!0}reset(){this.clearSelection(),this.clearHints(),this.free=[],this.count=0,this.stones=[],this.undo=[]}canRemove(t){return t.group.some(e=>!e.picked&&!e.isBlocked())}update(){let t=[],e=0;for(let s of this.stones)s.state={blocked:!s.picked&&s.isBlocked(),removable:!1},e+=s.picked?0:1;for(let s of this.stones)s.state.removable=!s.picked&&!s.state.blocked&&this.canRemove(s),s.state.removable&&t.push(s);this.free=t,this.count=e}back(){if(this.undo.length<2)return;this.clearSelection(),this.clearHints();let t=this.undo.pop(),e=this.undo.pop();if(!(!t||!e)){for(let s of this.stones)(s.z===t[0]&&s.x===t[1]&&s.y===t[2]||s.z===e[0]&&s.x===e[1]&&s.y===e[2])&&(s.picked=!1);this.update()}}shuffle(){this.clearSelection(),this.clearHints();let t=[],e=new m(this.stones.length);for(let r of this.stones)r.picked||t.push([r.z,r.x,r.y]);let i=new l(e).build(L,t);if(!i)return;let h=e.list.filter(r=>!i.some(g=>g.v===r.v));for(let r of this.undo){let g=h.shift();if(g){let c=new D(r[0],r[1],r[2],g.v,g.groupNr);c.picked=!0,i.push(c)}}K.fillStones(i,e),this.stones=i,this.update()}load(t,e){if(!t)return;this.undo=e;let i=new l(new m(t.length+e.length)).load(t);if(i){for(let h of e){let r=O(i,h[0],h[1],h[2]);r&&(r.picked=!0)}this.stones=i,this.update()}}save(){return this.stones.map(t=>[t.z,t.x,t.y,t.v])}applyMapping(t,e){let s=new l(new m(t.length));this.stones=s.build(e,t)||[]}pick(t,e){this.clearSelection(),this.undo.push([t.z,t.x,t.y],[e.z,e.x,e.y]),this.clearHints(),t.picked=!0,e.picked=!0,this.update()}hintNext(){if(!this.hints.current)return!1;for(let e of this.hints.current.stones)e.hinted=!1;let t=this.hints.groups.indexOf(this.hints.current);if(t>=0&&(t++,t>=this.hints.groups.length&&(t=0),t<this.hints.groups.length)){this.hints.current=this.hints.groups[t];for(let e of this.hints.current.stones)e.hinted=!0;return!0}return!1}collectHints(){let t={};for(let e of this.free){let s=e.groupNr.toString();t[s]=t[s]||[],t[s].push(e)}return Object.keys(t).map(e=>({group:t[e][0].groupNr,stones:t[e]}))}};var w=class{constructor(){this.elapsed=0,this.lastTime=0,this.timer=void 0}start(){this.timer||(this.elapsed=this.elapsed||0)}reset(){this.timer&&(window.clearTimeout(this.timer),this.timer=void 0),this.lastTime=0,this.elapsed=0}run(){this.timer||(this.lastTime=Date.now(),this.timer=window.setTimeout(()=>{this.step()},1e3))}pause(){this.timer&&(window.clearTimeout(this.timer),this.timer=void 0,this.elapsed+=Date.now()-this.lastTime)}step(){let t=Date.now();this.elapsed+=t-this.lastTime,this.lastTime=t,this.timer=window.setTimeout(()=>{this.step()},1e3)}};var u={NOPE:"invalid",SELECT:"select",MATCH:"match",OVER:"over"},y=class{constructor(){this.enabled=!0,this.audioplayers={}}play(t){if(this.enabled){if(!this.audioplayers[t]){let e=new Audio;e.src=`assets/sounds/${t}.ogg`,e.load(),this.audioplayers[t]=e}this.audioplayers[t].play().catch(e=>{console.error(e)})}}pause(t){this.audioplayers[t]&&this.audioplayers[t].pause()}};var f=class{constructor(){this.enabled=!1}play(){}pause(){}toggle(){}toggleMusic(){}};var P="random-";var b=class{constructor(t){this.storage=t,this.clock=new w,this.board=new p,this.sound=new y,this.music=new f,this.state=n.idle,this.layoutID=void 0,this.mode=M,this.saveTimer=void 0}init(){this.load(),this.board.update(),this.state===n.run&&this.pause(),this.message={messageID:this.isPaused()?"MSG_CONTINUE_SAVE":"MSG_START"}}click(t){return t?!this.isRunning()||t.state.blocked?(this.sound.play(u.NOPE),this.wiggleStone(t),!0):(this.clock.elapsed===0&&this.clock.run(),this.board.selected&&t&&t!==this.board.selected&&t.groupNr===this.board.selected.groupNr?(this.resolveMatchingStone(t),!0):(this.board.setStoneSelected(this.board.selected===t?void 0:t),this.sound.play(u.SELECT),!0)):(this.board.clearSelection(),!1)}wiggleStone(t){t&&(t.effects=t.effects||{},t.effects.wiggle=!0,setTimeout(()=>{t.effects&&(t.effects.wiggle=!1)},300))}isRunning(){return this.state===n.run}isPaused(){return this.state===n.pause}isIdle(){return this.state===n.idle}resume(){this.run(),this.clock.run(),this.music.play()}run(){this.board.clearHints(),this.board.update(),this.setState(n.run)}toggle(){this.state===n.run?this.pause():this.state===n.pause&&this.resume()}pause(){this.clock.pause(),this.setState(n.pause,"MSG_CONTINUE_PAUSE"),this.save(),this.music.pause()}reset(){this.clock.reset(),this.setState(n.idle),this.board.reset()}start(t,e,s){this.layoutID=t.id,this.mode=s,this.board.applyMapping(t.mapping,e),this.board.update(),this.run()}hint(){this.mode!==_&&this.board.hint()}shuffle(){this.mode===N&&this.board.shuffle()}back(){this.mode!==_&&this.isRunning()&&this.board.back()}load(){try{let t=this.storage.getState();if(t?.stones)return this.clock.elapsed=t.elapsed??0,this.layoutID=t.layout,this.mode=t.gameMode??M,this.state=t.state??n.idle,this.board.load(t.stones,t.undo??[]),!0}catch(t){console.error("load state failed",t)}return!1}save(){if(this.layoutID)try{this.storage.storeState({elapsed:this.clock.elapsed,state:this.state,layout:this.layoutID,gameMode:this.mode,undo:this.board.undo,stones:this.board.save()})}catch(t){console.error("storing state failed",t)}}isStorableLayoutId(){return this.layoutID!=null&&!this.layoutID.startsWith(P)}gameOverLosing(){if(this.isStorableLayoutId()){let t=this.layoutID??"unknown",e=this.storage.getScore(t)??{};e.playCount=(e.playCount??0)+1,this.storage.storeScore(t,e)}this.gameOver("MSG_FAIL")}gameOverWinning(){let t=this.clock.elapsed;if(!this.isStorableLayoutId()){this.gameOver("MSG_GOOD",t);return}let e=this.layoutID??"unknown",s=this.storage.getScore(e)??{};s.playCount=(s.playCount??0)+1,!s.bestTime||s.bestTime>t?(s.bestTime=t,this.gameOver("MSG_BEST",t)):this.gameOver("MSG_GOOD",t),this.storage.storeScore(e,s)}delayedSave(){clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>{this.save()},300)}resolveMatchingStone(t){let e=this.board.selected;e&&(this.board.pick(e,t),this.board.count<2?this.gameOverWinning():this.board.free.length===0?this.gameOverLosing():(this.sound.play(u.MATCH),this.delayedSave()))}gameOver(t,e){this.sound.play(u.OVER),this.setState(n.idle,t,e),this.clock.reset(),this.delayedSave()}setState(t,e,s){this.message=e?{messageID:e,playTime:s}:void 0,this.state=t}};var k=class{constructor(t){this.storageProvider=t,this.lang=A,this.sounds=!0,this.tileset=S,this.music=!1,this.contrast=!1,this.dark=!1,this.background="",this.theme=T,this.stats={games:0,bestTime:0}}load(){try{let t=this.storageProvider.getSettings();return t&&(this.lang=t.lang??A,this.tileset=t.tileset??S,this.background=t.background??this.background,this.theme=t.theme??T,this.contrast=t.contrast??!1,this.dark=t.dark??!1,this.sounds=t.sounds??this.sounds,this.music=t.music??this.music,this.kyodaiUrl=t.kyodaiUrl),!0}catch(t){console.error("load settings failed",t)}return!1}save(){try{return this.storageProvider.storeSettings({lang:this.lang,sounds:this.sounds,music:this.music,contrast:this.contrast,dark:this.dark,background:this.background,theme:this.theme,tileset:this.tileset,kyodaiUrl:this.kyodaiUrl}),!0}catch(t){console.error("storing settings failed",t)}return!1}};var ft=(()=>{let t=class t{constructor(){this.name="Mah Jong",this.storage=j(R),this.translate=j(I),this.game=new b(this.storage),this.settings=new k(this.storage),this.settings.load(),this.setLang(),this.game.init(),this.game.sound.enabled=this.settings.sounds,this.game.music.enabled=this.settings.music}setLang(){let s=!this.settings.lang||this.settings.lang===G?(navigator.language.split("-")[0]||"en").toLowerCase():this.settings.lang;Object.keys($).includes(s)?this.translate.use(s):this.translate.use("en")}toggleSound(){this.settings.sounds=!this.settings.sounds,this.game.sound.enabled=this.settings.sounds,this.settings.save()}toggleMusic(){this.settings.music=!this.settings.music,this.game.music.enabled=this.settings.music,this.game.music.toggle(),this.settings.save()}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=x({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();function vt(o){return["kyodai","kyodai-black"].includes(o)}var jt=[{name:"Traditional",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191758/https://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/79546_orig.jpg"},{name:"Cards",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/4962942_orig.jpg"},{name:"Board Games",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/3862268_orig.jpg"},{name:"Motorcycles",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8438984_orig.jpg"},{name:"NHL",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/630927_orig.jpg"},{name:"Social Media",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/241535_orig.jpg"},{name:"Monopoly",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9084861_orig.jpg"},{name:"Horror Films",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/849930_orig.jpg"},{name:"Animated Movies",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2303366_orig.jpg"},{name:"Stephen King",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/4168429_orig.jpg"},{name:"Lord of the Rings",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/3966297_orig.jpg"},{name:"007",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9617288_orig.jpg"},{name:"Disney Princess",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2281343_orig.jpg"},{name:"Religions",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191748im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2620625_orig.jpg"},{name:"Happy Eastern",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/1396173_orig.jpg"},{name:"Halloween",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8455923_orig.jpg"},{name:"Neck Ties",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9349600_orig.jpg"},{name:"Floral",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/3178635_orig.jpg"},{name:"Easter Eggs",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8685131_orig.jpg"},{name:"St. Patricks Day",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/7310933_orig.jpg"},{name:"Valentine's Day",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/1140822_orig.jpg"},{name:"Christmas",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/1525811_orig.jpg"},{name:"Canada Flower & Birds",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2953105_orig.jpg"},{name:"Canada Scenery",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8401335_orig.jpg"},{name:"Nova Scotia",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2933195_orig.jpg"},{name:"Canada Birds",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9756515_orig.jpg"},{name:"Arabic Alphabet & Numbers",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170902065732im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/5652995_orig.jpg"},{name:"Mahjongg Platinum 2 Dark",author:"Pavel Osharin",source:"https://web.archive.org/web/20170903191723im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2479283_orig.jpg"},{name:"Mahjongg Platinum 2 Red",author:"Pavel Osharin",source:"https://web.archive.org/web/20170903191723im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2090721_orig.jpg"},{name:"Mahjongg Titans",author:"Microsoft Vista",source:"https://web.archive.org/web/20170903191723im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/6604294_orig.jpg"},{name:"Viking Artifacts 1",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/VikingArtifacts.jpg"},{name:"Viking Artifacts 2",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/VikingArtifacts2.jpg"},{name:"Art of the Scythians",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/ScythianArt.jpg"},{name:"Waite-Rider Tarot",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/WaiteRiderTarot.jpg"},{name:"Waite-Rider Tarot Images",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725im_/http://www.vikinganswerlady.com/kyodai/WaiteRiderTarotImagesThumbnail.jpg"},{name:"Morgan-Greer Tarot",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/MorganGreerTarot.jpg"},{name:"Xena: Tarot of the Bitter Suite",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/BitterSuite.jpg"},{name:"A Rainbow of Bearded Irises",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/RainbowIris.jpg"},{name:"Antique Roses",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/AntiqueRoses.jpg"},{name:"Flags of the World",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725im_/http://www.vikinganswerlady.com/kyodai/FlagsThumbnail.jpg"},{name:"X-Men",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/XMen.jpg"},{name:"Age of Empires II: Age of Kings",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/AOEII.jpg"}];function B(o){return v(this,null,function*(){return new Promise((t,e)=>{let s=new Image;s.addEventListener("load",()=>{t(s)}),s.addEventListener("error",i=>{console.error(i),e(new Error(`Image ${o} could not be loaded.`))}),s.src=o})})}function H(o,t,e,s){let i="";for(let[h,r]of o.entries()){let g=h*e;for(let[c,a]of r.entries()){let d=c*s;i+=`<svg preserveAspectRatio="xMidYMid slice" id="${a}" width="75" height="100" viewBox="${d} ${g} ${s} ${e}"><use xlink:href="#${t}"></use></svg>`}}return i}function _t(o){return v(this,null,function*(){if(!o)return"<svg><defs></defs></svg>";let t=(a,d)=>[...Array.from({length:d}).keys()].map(U=>U+a),e=[t(1,9).map(a=>`do${a}`),t(1,9).map(a=>`ba${a}`),t(1,9).map(a=>`ch${a}`),["se_winter","se_spring","se_summer","se_fall","wi_north","wi_south","wi_east","wi_west"],["fl_bamboo","fl_plum","fl_orchid","fl_chrysanthemum","dr_green","dr_white","dr_red"]].map(a=>a.map(d=>`t_${d}`)),s=[t(1,9).map(a=>`g${a}`),t(10,9).map(a=>`g${a}`),t(1,9).map(a=>`e${a}`)].map(a=>a.map(d=>`t_${d}`)),i=yield B(o),h=i.height/5,r=i.width/9,g=E(o),c=E("kyodai-extra");return`<svg><defs>
<image id="${g}" xlink:href="${o}" x="0" y="0" height="${i.height}" width="${i.width}"/>
<image id="${c}" xlink:href="/assets/svg/kyodai-extra.png" x="0" y="0" height="300" width="675"/>
${H(e,g,h,r)}
${H(s,c,100,75)}
</defs></svg>
`})}export{P as a,$ as b,ft as c,vt as d,jt as e,_t as f};
