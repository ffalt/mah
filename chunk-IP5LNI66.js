import{C as p,D as G,F as I,g as D,h as x,i as R,j as K,l as m,n,o as N,p as M,q as A,w as E,x as S,y as L,z as T}from"./chunk-T4PI2SPK.js";import{b as _,u as O,vb as P,y as j}from"./chunk-PC2ESRTN.js";var u={APP_VERSION:"1.11.0",APP_NAME:"Mah",APP_FEATURE_EDITOR:!0,APP_FEATURE_KYODAI:!0,APP_FEATURE_MOBILE:!1};var W={production:!0,version:u.APP_VERSION,name:u.APP_NAME,mobile:u.APP_FEATURE_MOBILE,editor:u.APP_FEATURE_EDITOR,kyodai:u.APP_FEATURE_KYODAI,modules:[]};var U={en:{title:"English"},de:{title:"Deutsch"},nl:{title:"Nederlands"},pt:{title:"Portugu\xEAs"},ru:{title:"\u0440\u0443\u0441\u0441\u043A\u0438\u0439"},es:{title:"Espa\xF1ol"},eu:{title:"Euskara"},jp:{title:"\u65E5\u672C\u8A9E"},fr:{title:"Fran\xE7ais"}};var w=class{constructor(){this.free=[],this.stones=[],this.count=0,this.hints={groups:[],current:void 0},this.selected=void 0,this.undo=[]}clearSelection(){this.selected&&(this.selected.selected=!1),this.selected=void 0}setStoneSelected(e){this.clearSelection(),e&&(e.selected=!0,this.selected=e)}clearHints(){if(this.hints.current)for(let e of this.hints.current.stones)e.hinted=!1;this.hints={groups:[],current:void 0}}hint(){if(this.hintNext()||(this.clearHints(),this.free.length===0))return;let e=this.collectHints();if(this.selected){let s=this.selected.groupNr;e.sort((i,h)=>i.group===s?-1:h.group===s?1:0)}let t=e[0];this.hints={groups:e,current:t};for(let s of t.stones)s.hinted=!0}reset(){this.clearSelection(),this.clearHints(),this.free=[],this.count=0,this.stones=[],this.undo=[]}canRemove(e){return e.group.some(t=>!t.picked&&!t.isBlocked())}update(){let e=[],t=0;for(let s of this.stones)s.state={blocked:!s.picked&&s.isBlocked(),removable:!1},t+=s.picked?0:1;for(let s of this.stones)s.state.removable=!s.picked&&!s.state.blocked&&this.canRemove(s),s.state.removable&&e.push(s);this.free=e,this.count=t}back(){if(this.undo.length<2)return;this.clearSelection(),this.clearHints();let e=this.undo.pop(),t=this.undo.pop();if(!(!e||!t)){for(let s of this.stones)(s.z===e[0]&&s.x===e[1]&&s.y===e[2]||s.z===t[0]&&s.x===t[1]&&s.y===t[2])&&(s.picked=!1);this.update()}}shuffle(){this.clearSelection(),this.clearHints();let e=[],t=new p(this.stones.length);for(let r of this.stones)r.picked||e.push([r.z,r.x,r.y]);let i=new m(t).build(K,e);if(!i)return;let h=t.list.filter(r=>!i.some(g=>g.v===r.v));for(let r of this.undo){let g=h.shift();if(g){let c=new D(r[0],r[1],r[2],g.v,g.groupNr);c.picked=!0,i.push(c)}}R.fillStones(i,t),this.stones=i,this.update()}load(e,t){if(!e)return;this.undo=t;let i=new m(new p(e.length+t.length)).load(e);if(i){for(let h of t){let r=x(i,h[0],h[1],h[2]);r&&(r.picked=!0)}this.stones=i,this.update()}}save(){return this.stones.map(e=>[e.z,e.x,e.y,e.v])}applyMapping(e,t){let s=new m(new p(e.length));this.stones=s.build(t,e)||[]}pick(e,t){this.clearSelection(),this.undo.push([e.z,e.x,e.y],[t.z,t.x,t.y]),this.clearHints(),e.picked=!0,t.picked=!0,this.update()}hintNext(){if(!this.hints.current)return!1;for(let t of this.hints.current.stones)t.hinted=!1;let e=this.hints.groups.indexOf(this.hints.current);if(e>=0&&(e++,e>=this.hints.groups.length&&(e=0),e<this.hints.groups.length)){this.hints.current=this.hints.groups[e];for(let t of this.hints.current.stones)t.hinted=!0;return!0}return!1}collectHints(){let e={};for(let t of this.free){let s=t.groupNr.toString();e[s]=e[s]||[],e[s].push(t)}return Object.keys(e).map(t=>({group:e[t][0].groupNr,stones:e[t]}))}};var y=class{constructor(){this.elapsed=0,this.lastTime=0,this.timer=void 0}start(){this.timer||(this.elapsed=this.elapsed||0)}reset(){this.timer&&(window.clearTimeout(this.timer),this.timer=void 0),this.lastTime=0,this.elapsed=0}run(){this.timer||(this.lastTime=Date.now(),this.timer=window.setTimeout(()=>{this.step()},1e3))}pause(){this.timer&&(window.clearTimeout(this.timer),this.timer=void 0,this.elapsed+=Date.now()-this.lastTime)}step(){let e=Date.now();this.elapsed+=e-this.lastTime,this.lastTime=e,this.timer=window.setTimeout(()=>{this.step()},1e3)}};var l={NOPE:"invalid",SELECT:"select",MATCH:"match",OVER:"over"},f=class{constructor(){this.enabled=!0,this.audioplayers={}}play(e){if(this.enabled){if(!this.audioplayers[e]){let t=new Audio;t.src=`assets/sounds/${e}.ogg`,t.load(),this.audioplayers[e]=t}this.audioplayers[e].play().catch(t=>{console.error(t)})}}pause(e){this.audioplayers[e]&&this.audioplayers[e].pause()}};var b=class{constructor(){this.enabled=!1}play(){}pause(){}toggle(){}toggleMusic(){}};var $="random-";var k=class{constructor(e){this.storage=e,this.clock=new y,this.board=new w,this.sound=new f,this.music=new b,this.state=n.idle,this.layoutID=void 0,this.mode=M,this.saveTimer=void 0}init(){this.load(),this.board.update(),this.state===n.run&&this.pause(),this.message={messageID:this.isPaused()?"MSG_CONTINUE_SAVE":"MSG_START"}}click(e){return e?!this.isRunning()||e.state.blocked?(this.sound.play(l.NOPE),this.wiggleStone(e),!0):(this.clock.elapsed===0&&this.clock.run(),this.board.selected&&e&&e!==this.board.selected&&e.groupNr===this.board.selected.groupNr?(this.resolveMatchingStone(e),!0):(this.board.setStoneSelected(this.board.selected===e?void 0:e),this.sound.play(l.SELECT),!0)):(this.board.clearSelection(),!1)}wiggleStone(e){e&&(e.effects=e.effects||{},e.effects.wiggle=!0,setTimeout(()=>{e.effects&&(e.effects.wiggle=!1)},300))}isRunning(){return this.state===n.run}isPaused(){return this.state===n.pause}isIdle(){return this.state===n.idle}resume(){this.run(),this.clock.run(),this.music.play()}run(){this.board.clearHints(),this.board.update(),this.setState(n.run)}toggle(){this.state===n.run?this.pause():this.state===n.pause&&this.resume()}pause(){this.clock.pause(),this.setState(n.pause,"MSG_CONTINUE_PAUSE"),this.save(),this.music.pause()}reset(){this.clock.reset(),this.setState(n.idle),this.board.reset()}start(e,t,s){this.layoutID=e.id,this.mode=s,this.board.applyMapping(e.mapping,t),this.board.update(),this.run()}hint(){this.mode!==A&&this.board.hint()}shuffle(){this.mode===N&&this.board.shuffle()}back(){this.mode!==A&&this.isRunning()&&this.board.back()}load(){try{let e=this.storage.getState();if(e?.stones)return this.clock.elapsed=e.elapsed??0,this.layoutID=e.layout,this.mode=e.gameMode??M,this.state=e.state??n.idle,this.board.load(e.stones,e.undo??[]),!0}catch(e){console.error("load state failed",e)}return!1}save(){if(this.layoutID)try{this.storage.storeState({elapsed:this.clock.elapsed,state:this.state,layout:this.layoutID,gameMode:this.mode,undo:this.board.undo,stones:this.board.save()})}catch(e){console.error("storing state failed",e)}}isStorableLayoutId(){return this.layoutID!=null&&!this.layoutID.startsWith($)}gameOverLosing(){if(this.isStorableLayoutId()){let e=this.layoutID??"unknown",t=this.storage.getScore(e)??{};t.playCount=(t.playCount??0)+1,this.storage.storeScore(e,t)}this.gameOver("MSG_FAIL")}gameOverWinning(){let e=this.clock.elapsed;if(!this.isStorableLayoutId()){this.gameOver("MSG_GOOD",e);return}let t=this.layoutID??"unknown",s=this.storage.getScore(t)??{};s.playCount=(s.playCount??0)+1,!s.bestTime||s.bestTime>e?(s.bestTime=e,this.gameOver("MSG_BEST",e)):this.gameOver("MSG_GOOD",e),this.storage.storeScore(t,s)}delayedSave(){clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>{this.save()},300)}resolveMatchingStone(e){let t=this.board.selected;t&&(this.board.pick(t,e),this.board.count<2?this.gameOverWinning():this.board.free.length===0?this.gameOverLosing():(this.sound.play(l.MATCH),this.delayedSave()))}gameOver(e,t){this.sound.play(l.OVER),this.setState(n.idle,e,t),this.clock.reset(),this.delayedSave()}setState(e,t,s){this.message=t?{messageID:t,playTime:s}:void 0,this.state=e}};var v=class{constructor(e){this.storageProvider=e,this.lang=T,this.sounds=!0,this.tileset=E,this.music=!1,this.contrast=!1,this.dark=!1,this.background="",this.theme=S,this.stats={games:0,bestTime:0}}load(){try{let e=this.storageProvider.getSettings();return e&&(this.lang=e.lang??T,this.tileset=e.tileset??E,this.background=e.background??this.background,this.theme=e.theme??S,this.contrast=e.contrast??!1,this.dark=e.dark??!1,this.sounds=e.sounds??this.sounds,this.music=e.music??this.music,this.kyodaiUrl=e.kyodaiUrl),!0}catch(e){console.error("load settings failed",e)}return!1}save(){try{return this.storageProvider.storeSettings({lang:this.lang,sounds:this.sounds,music:this.music,contrast:this.contrast,dark:this.dark,background:this.background,theme:this.theme,tileset:this.tileset,kyodaiUrl:this.kyodaiUrl}),!0}catch(e){console.error("storing settings failed",e)}return!1}};var je=(()=>{let e=class e{constructor(){this.name="Mah Jong",this.storage=j(G),this.translate=j(P),this.game=new k(this.storage),this.settings=new v(this.storage),this.settings.load(),this.setLang(),this.game.init(),this.game.sound.enabled=this.settings.sounds,this.game.music.enabled=this.settings.music}setLang(){let s=!this.settings.lang||this.settings.lang===L?(navigator.language.split("-")[0]||"en").toLowerCase():this.settings.lang;Object.keys(U).includes(s)?this.translate.use(s):this.translate.use("en")}toggleSound(){this.settings.sounds=!this.settings.sounds,this.game.sound.enabled=this.settings.sounds,this.settings.save()}toggleMusic(){this.settings.music=!this.settings.music,this.game.music.enabled=this.settings.music,this.game.music.toggle(),this.settings.save()}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();function Ee(o){return["kyodai","kyodai-black"].includes(o)}var Se=[{name:"Traditional",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191758/https://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/79546_orig.jpg"},{name:"Cards",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/4962942_orig.jpg"},{name:"Board Games",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/3862268_orig.jpg"},{name:"Motorcycles",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8438984_orig.jpg"},{name:"NHL",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/630927_orig.jpg"},{name:"Social Media",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/241535_orig.jpg"},{name:"Monopoly",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9084861_orig.jpg"},{name:"Horror Films",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/849930_orig.jpg"},{name:"Animated Movies",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2303366_orig.jpg"},{name:"Stephen King",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/4168429_orig.jpg"},{name:"Lord of the Rings",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/3966297_orig.jpg"},{name:"007",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9617288_orig.jpg"},{name:"Disney Princess",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2281343_orig.jpg"},{name:"Religions",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191748im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2620625_orig.jpg"},{name:"Happy Eastern",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/1396173_orig.jpg"},{name:"Halloween",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8455923_orig.jpg"},{name:"Neck Ties",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9349600_orig.jpg"},{name:"Floral",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/3178635_orig.jpg"},{name:"Easter Eggs",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8685131_orig.jpg"},{name:"St. Patricks Day",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/7310933_orig.jpg"},{name:"Valentine's Day",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/1140822_orig.jpg"},{name:"Christmas",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/1525811_orig.jpg"},{name:"Canada Flower & Birds",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2953105_orig.jpg"},{name:"Canada Scenery",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8401335_orig.jpg"},{name:"Nova Scotia",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2933195_orig.jpg"},{name:"Canada Birds",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9756515_orig.jpg"},{name:"Arabic Alphabet & Numbers",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170902065732im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/5652995_orig.jpg"},{name:"Mahjongg Platinum 2 Dark",author:"Pavel Osharin",source:"https://web.archive.org/web/20170903191723im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2479283_orig.jpg"},{name:"Mahjongg Platinum 2 Red",author:"Pavel Osharin",source:"https://web.archive.org/web/20170903191723im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2090721_orig.jpg"},{name:"Mahjongg Titans",author:"Microsoft Vista",source:"https://web.archive.org/web/20170903191723im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/6604294_orig.jpg"},{name:"Viking Artifacts 1",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/VikingArtifacts.jpg"},{name:"Viking Artifacts 2",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/VikingArtifacts2.jpg"},{name:"Art of the Scythians",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/ScythianArt.jpg"},{name:"Waite-Rider Tarot",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/WaiteRiderTarot.jpg"},{name:"Waite-Rider Tarot Images",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725im_/http://www.vikinganswerlady.com/kyodai/WaiteRiderTarotImagesThumbnail.jpg"},{name:"Morgan-Greer Tarot",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/MorganGreerTarot.jpg"},{name:"Xena: Tarot of the Bitter Suite",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/BitterSuite.jpg"},{name:"A Rainbow of Bearded Irises",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/RainbowIris.jpg"},{name:"Antique Roses",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/AntiqueRoses.jpg"},{name:"Flags of the World",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725im_/http://www.vikinganswerlady.com/kyodai/FlagsThumbnail.jpg"},{name:"X-Men",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/XMen.jpg"},{name:"Age of Empires II: Age of Kings",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/AOEII.jpg"}];function H(o){return _(this,null,function*(){return new Promise((e,t)=>{let s=new Image;s.addEventListener("load",()=>{e(s)}),s.addEventListener("error",i=>{console.error(i),t(new Error(`Image ${o} could not be loaded.`))}),s.src=o})})}function C(o,e,t,s){let i="";for(let[h,r]of o.entries()){let g=h*t;for(let[c,a]of r.entries()){let d=c*s;i+=`<svg preserveAspectRatio="xMidYMid slice" id="${a}" width="75" height="100" viewBox="${d} ${g} ${s} ${t}"><use xlink:href="#${e}"></use></svg>`}}return i}function Te(o){return _(this,null,function*(){if(!o)return"<svg><defs></defs></svg>";let e=(a,d)=>[...Array.from({length:d}).keys()].map(B=>B+a),t=[e(1,9).map(a=>`do${a}`),e(1,9).map(a=>`ba${a}`),e(1,9).map(a=>`ch${a}`),["se_winter","se_spring","se_summer","se_fall","wi_north","wi_south","wi_east","wi_west"],["fl_bamboo","fl_plum","fl_orchid","fl_chrysanthemum","dr_green","dr_white","dr_red"]].map(a=>a.map(d=>`t_${d}`)),s=[e(1,9).map(a=>`g${a}`),e(10,9).map(a=>`g${a}`),e(1,9).map(a=>`e${a}`)].map(a=>a.map(d=>`t_${d}`)),i=yield H(o),h=i.height/5,r=i.width/9,g=I(o),c=I("kyodai-extra");return`<svg><defs>
<image id="${g}" xlink:href="${o}" x="0" y="0" height="${i.height}" width="${i.width}"/>
<image id="${c}" xlink:href="/assets/svg/kyodai-extra.png" x="0" y="0" height="300" width="675"/>
${C(t,g,h,r)}
${C(s,c,100,75)}
</defs></svg>
`})}export{W as a,$ as b,U as c,je as d,Ee as e,Se as f,Te as g};
