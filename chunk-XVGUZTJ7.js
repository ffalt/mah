import{B as l,C as K,E as N,g as I,h as O,i as P,j as D,l as u,n as r,o as R,p as v,q as j,v as M,w as A,x,y as E}from"./chunk-GS2LP4F2.js";import{b as _,u as S,ub as T,y as k}from"./chunk-UWITPWPI.js";var g={APP_VERSION:"1.9.0",APP_NAME:"Mah",APP_FEATURE_EDITOR:!0,APP_FEATURE_KYODAI:!0,APP_FEATURE_MOBILE:!1};var W={production:!0,version:g.APP_VERSION,name:g.APP_NAME,mobile:g.APP_FEATURE_MOBILE,editor:g.APP_FEATURE_EDITOR,kyodai:g.APP_FEATURE_KYODAI,modules:[]};var L={en:{title:"English"},de:{title:"Deutsch"},nl:{title:"Nederlands"},pt:{title:"Portugu\xEAs"},ru:{title:"\u0440\u0443\u0441\u0441\u043A\u0438\u0439"},es:{title:"Espa\xF1ol"},eu:{title:"Euskara"},jp:{title:"\u65E5\u672C\u8A9E"},fr:{title:"Fran\xE7ais"}};var m=class{constructor(){this.free=[],this.stones=[],this.count=0,this.hints={groups:[],current:void 0},this.selected=void 0,this.undo=[]}clearSelection(){this.selected&&(this.selected.selected=!1),this.selected=void 0}setStoneSelected(t){this.clearSelection(),t&&(t.selected=!0,this.selected=t)}clearHints(){if(this.hints.current)for(let t of this.hints.current.stones)t.hinted=!1;this.hints={groups:[],current:void 0}}hint(){if(this.hintNext()||(this.clearHints(),this.free.length===0))return;let t=this.collectHints();if(this.selected){let s=this.selected.groupNr;t.sort((o,n)=>o.group===s?-1:n.group===s?1:0)}let e=t[0];this.hints={groups:t,current:e};for(let s of e.stones)s.hinted=!0}reset(){this.clearSelection(),this.clearHints(),this.free=[],this.count=0,this.stones=[],this.undo=[]}canRemove(t){return t.group.some(e=>!e.picked&&!e.isBlocked())}update(){let t=[],e=0;for(let s of this.stones)s.state={blocked:!s.picked&&s.isBlocked(),removable:!1},e+=s.picked?0:1;for(let s of this.stones)s.state.removable=!s.picked&&!s.state.blocked&&this.canRemove(s),s.state.removable&&t.push(s);this.free=t,this.count=e}back(){if(this.undo.length<2)return;this.clearSelection(),this.clearHints();let t=this.undo.pop(),e=this.undo.pop();if(!(!t||!e)){for(let s of this.stones)(s.z===t[0]&&s.x===t[1]&&s.y===t[2]||s.z===e[0]&&s.x===e[1]&&s.y===e[2])&&(s.picked=!1);this.update()}}shuffle(){this.clearSelection(),this.clearHints();let t=[],e=new l(this.stones.length);for(let a of this.stones)a.picked||t.push([a.z,a.x,a.y]);let o=new u(e).build(D,t);if(!o)return;let n=e.list.filter(a=>!o.some(h=>h.v===a.v));for(let a of this.undo){let h=n.shift();if(h){let d=new I(a[0],a[1],a[2],h.v,h.groupNr);d.picked=!0,o.push(d)}}P.fillStones(o,e),this.stones=o,this.update()}load(t,e){if(!t)return;this.undo=e;let o=new u(new l(t.length+e.length)).load(t);if(o){for(let n of e){let a=O(o,n[0],n[1],n[2]);a&&(a.picked=!0)}this.stones=o,this.update()}}save(){return this.stones.map(t=>[t.z,t.x,t.y,t.v])}applyMapping(t,e){let s=new u(new l(t.length));this.stones=s.build(e,t)||[]}pick(t,e){this.clearSelection(),this.undo.push([t.z,t.x,t.y],[e.z,e.x,e.y]),this.clearHints(),t.picked=!0,e.picked=!0,this.update()}hintNext(){if(!this.hints.current)return!1;for(let e of this.hints.current.stones)e.hinted=!1;let t=this.hints.groups.indexOf(this.hints.current);if(t>=0&&(t++,t>=this.hints.groups.length&&(t=0),t<this.hints.groups.length)){this.hints.current=this.hints.groups[t];for(let e of this.hints.current.stones)e.hinted=!0;return!0}return!1}collectHints(){let t={};for(let e of this.free){let s=e.groupNr.toString();t[s]=t[s]||[],t[s].push(e)}return Object.keys(t).map(e=>({group:t[e][0].groupNr,stones:t[e]}))}};var p=class{constructor(){this.elapsed=0,this.lastTime=0,this.timer=void 0}start(){this.timer||(this.elapsed=this.elapsed||0)}reset(){this.timer&&(window.clearTimeout(this.timer),this.timer=void 0),this.lastTime=0,this.elapsed=0}run(){this.timer||(this.lastTime=Date.now(),this.timer=window.setTimeout(()=>{this.step()},1e3))}pause(){this.timer&&(window.clearTimeout(this.timer),this.timer=void 0,this.elapsed+=Date.now()-this.lastTime)}step(){let t=Date.now();this.elapsed+=t-this.lastTime,this.lastTime=t,this.timer=window.setTimeout(()=>{this.step()},1e3)}};var c={NOPE:"invalid",SELECT:"select",MATCH:"match",OVER:"over"},w=class{constructor(){this.enabled=!0,this.audioplayers={}}play(t){if(this.enabled){if(!this.audioplayers[t]){let e=new Audio;e.src=`assets/sounds/${t}.ogg`,e.load(),this.audioplayers[t]=e}this.audioplayers[t].play().catch(e=>{console.error(e)})}}pause(t){this.audioplayers[t]&&this.audioplayers[t].pause()}};var y=class{constructor(){this.enabled=!1}play(){}pause(){}toggle(){}toggleMusic(){}};var G="random-";var b=class{constructor(t){this.storage=t,this.clock=new p,this.board=new m,this.sound=new w,this.music=new y,this.state=r.idle,this.layoutID=void 0,this.mode=v,this.saveTimer=void 0}init(){this.load(),this.board.update(),this.state===r.run&&this.pause(),this.message={messageID:this.isPaused()?"MSG_CONTINUE_SAVE":"MSG_START"}}click(t){return t?!this.isRunning()||t.state.blocked?(this.sound.play(c.NOPE),this.wiggleStone(t),!0):(this.clock.elapsed===0&&this.clock.run(),this.board.selected&&t&&t!==this.board.selected&&t.groupNr===this.board.selected.groupNr?(this.resolveMatchingStone(t),!0):(this.board.setStoneSelected(this.board.selected===t?void 0:t),this.sound.play(c.SELECT),!0)):(this.board.clearSelection(),!1)}wiggleStone(t){t&&(t.effects=t.effects||{},t.effects.wiggle=!0,setTimeout(()=>{t.effects&&(t.effects.wiggle=!1)},300))}isRunning(){return this.state===r.run}isPaused(){return this.state===r.pause}isIdle(){return this.state===r.idle}resume(){this.run(),this.clock.run(),this.music.play()}run(){this.board.clearHints(),this.board.update(),this.setState(r.run)}toggle(){this.state===r.run?this.pause():this.state===r.pause&&this.resume()}pause(){this.clock.pause(),this.setState(r.pause,"MSG_CONTINUE_PAUSE"),this.save(),this.music.pause()}reset(){this.clock.reset(),this.setState(r.idle),this.board.reset()}start(t,e,s){this.layoutID=t.id,this.mode=s,this.board.applyMapping(t.mapping,e),this.board.update(),this.run()}hint(){this.mode!==j&&this.board.hint()}shuffle(){this.mode===R&&this.board.shuffle()}back(){this.mode!==j&&this.isRunning()&&this.board.back()}load(){try{let t=this.storage.getState();if(t?.stones)return this.clock.elapsed=t.elapsed??0,this.layoutID=t.layout,this.mode=t.gameMode??v,this.state=t.state??r.idle,this.board.load(t.stones,t.undo??[]),!0}catch(t){console.error("load state failed",t)}return!1}save(){if(this.layoutID)try{this.storage.storeState({elapsed:this.clock.elapsed,state:this.state,layout:this.layoutID,gameMode:this.mode,undo:this.board.undo,stones:this.board.save()})}catch(t){console.error("storing state failed",t)}}isStorableLayoutId(){return this.layoutID!=null&&!this.layoutID.startsWith(G)}gameOverLosing(){if(this.isStorableLayoutId()){let t=this.layoutID??"unknown",e=this.storage.getScore(t)??{};e.playCount=(e.playCount??0)+1,this.storage.storeScore(t,e)}this.gameOver("MSG_FAIL")}gameOverWinning(){let t=this.clock.elapsed;if(!this.isStorableLayoutId()){this.gameOver("MSG_GOOD",t);return}let e=this.layoutID??"unknown",s=this.storage.getScore(e)??{};s.playCount=(s.playCount??0)+1,!s.bestTime||s.bestTime>t?(s.bestTime=t,this.gameOver("MSG_BEST",t)):this.gameOver("MSG_GOOD",t),this.storage.storeScore(e,s)}delayedSave(){clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>{this.save()},300)}resolveMatchingStone(t){let e=this.board.selected;e&&(this.board.pick(e,t),this.board.count<2?this.gameOverWinning():this.board.free.length===0?this.gameOverLosing():(this.sound.play(c.MATCH),this.delayedSave()))}gameOver(t,e){this.sound.play(c.OVER),this.setState(r.idle,t,e),this.clock.reset(),this.delayedSave()}setState(t,e,s){this.message=e?{messageID:e,playTime:s}:void 0,this.state=t}};var f=class{constructor(t){this.storageProvider=t,this.lang=E,this.sounds=!0,this.tileset=M,this.music=!1,this.contrast=!1,this.dark=!1,this.background="",this.theme=A,this.stats={games:0,bestTime:0}}load(){try{let t=this.storageProvider.getSettings();return t&&(this.lang=t.lang??E,this.tileset=t.tileset??M,this.background=t.background??this.background,this.theme=t.theme??A,this.contrast=t.contrast??!1,this.dark=t.dark??!1,this.sounds=t.sounds??this.sounds,this.music=t.music??this.music,this.kyodaiUrl=t.kyodaiUrl),!0}catch(t){console.error("load settings failed",t)}return!1}save(){try{return this.storageProvider.storeSettings({lang:this.lang,sounds:this.sounds,music:this.music,contrast:this.contrast,dark:this.dark,background:this.background,theme:this.theme,tileset:this.tileset,kyodaiUrl:this.kyodaiUrl}),!0}catch(t){console.error("storing settings failed",t)}return!1}};var jt=(()=>{let t=class t{constructor(){this.name="Mah Jong",this.storage=k(K),this.translate=k(T),this.game=new b(this.storage),this.settings=new f(this.storage),this.settings.load(),this.setLang(),this.game.init(),this.game.sound.enabled=this.settings.sounds,this.game.music.enabled=this.settings.music}setLang(){let s=!this.settings.lang||this.settings.lang===x?(navigator.language.split("-")[0]||"en").toLowerCase():this.settings.lang;Object.keys(L).includes(s)?this.translate.use(s):this.translate.use("en")}toggleSound(){this.settings.sounds=!this.settings.sounds,this.game.sound.enabled=this.settings.sounds,this.settings.save()}toggleMusic(){this.settings.music=!this.settings.music,this.game.music.enabled=this.settings.music,this.game.music.toggle(),this.settings.save()}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=S({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();function Et(i){return["kyodai","kyodai-black"].includes(i)}var St=[{name:"Traditional",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191758/https://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/79546_orig.jpg"},{name:"Cards",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/4962942_orig.jpg"},{name:"Board Games",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/3862268_orig.jpg"},{name:"Motorcycles",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8438984_orig.jpg"},{name:"NHL",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/630927_orig.jpg"},{name:"Social Media",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/241535_orig.jpg"},{name:"Monopoly",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191753im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9084861_orig.jpg"},{name:"Horror Films",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/849930_orig.jpg"},{name:"Animated Movies",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2303366_orig.jpg"},{name:"Stephen King",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/4168429_orig.jpg"},{name:"Lord of the Rings",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/3966297_orig.jpg"},{name:"007",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9617288_orig.jpg"},{name:"Disney Princess",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191738im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2281343_orig.jpg"},{name:"Religions",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191748im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2620625_orig.jpg"},{name:"Happy Eastern",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/1396173_orig.jpg"},{name:"Halloween",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8455923_orig.jpg"},{name:"Neck Ties",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9349600_orig.jpg"},{name:"Floral",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/3178635_orig.jpg"},{name:"Easter Eggs",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8685131_orig.jpg"},{name:"St. Patricks Day",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/7310933_orig.jpg"},{name:"Valentine's Day",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/1140822_orig.jpg"},{name:"Christmas",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191728im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/1525811_orig.jpg"},{name:"Canada Flower & Birds",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2953105_orig.jpg"},{name:"Canada Scenery",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/8401335_orig.jpg"},{name:"Nova Scotia",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2933195_orig.jpg"},{name:"Canada Birds",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170903191743im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/9756515_orig.jpg"},{name:"Arabic Alphabet & Numbers",author:"My Kyodai Mahjongg",source:"https://web.archive.org/web/20170902065732im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/5652995_orig.jpg"},{name:"Mahjongg Platinum 2 Dark",author:"Pavel Osharin",source:"https://web.archive.org/web/20170903191723im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2479283_orig.jpg"},{name:"Mahjongg Platinum 2 Red",author:"Pavel Osharin",source:"https://web.archive.org/web/20170903191723im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/2090721_orig.jpg"},{name:"Mahjongg Titans",author:"Microsoft Vista",source:"https://web.archive.org/web/20170903191723im_/http://kyodaimahjongg.weebly.com/uploads/9/5/2/9/9529146/6604294_orig.jpg"},{name:"Viking Artifacts 1",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/VikingArtifacts.jpg"},{name:"Viking Artifacts 2",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/VikingArtifacts2.jpg"},{name:"Art of the Scythians",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/ScythianArt.jpg"},{name:"Waite-Rider Tarot",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/WaiteRiderTarot.jpg"},{name:"Waite-Rider Tarot Images",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725im_/http://www.vikinganswerlady.com/kyodai/WaiteRiderTarotImagesThumbnail.jpg"},{name:"Morgan-Greer Tarot",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/MorganGreerTarot.jpg"},{name:"Xena: Tarot of the Bitter Suite",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/BitterSuite.jpg"},{name:"A Rainbow of Bearded Irises",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/RainbowIris.jpg"},{name:"Antique Roses",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/AntiqueRoses.jpg"},{name:"Flags of the World",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725im_/http://www.vikinganswerlady.com/kyodai/FlagsThumbnail.jpg"},{name:"X-Men",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/XMen.jpg"},{name:"Age of Empires II: Age of Kings",author:"vikinganswerlady",source:"https://web.archive.org/web/20030919052725/http://www.vikinganswerlady.com/kyodai/AOEII.jpg"}];function H(i){return _(this,null,function*(){return new Promise((t,e)=>{let s=new Image;s.addEventListener("load",()=>{t(s)}),s.addEventListener("error",o=>{console.error(o),e(new Error(`Image ${i} could not be loaded.`))}),s.src=i})})}var V=[["t_do1","t_do2","t_do3","t_do4","t_do5","t_do6","t_do7","t_do8","t_do9"],["t_ba1","t_ba2","t_ba3","t_ba4","t_ba5","t_ba6","t_ba7","t_ba8","t_ba9"],["t_ch1","t_ch2","t_ch3","t_ch4","t_ch5","t_ch6","t_ch7","t_ch8","t_ch9"],["t_se_winter","t_se_spring","t_se_summer","t_se_fall","t_wi_north","t_wi_south","t_wi_east","t_wi_west"],["t_fl_bamboo","t_fl_plum","t_fl_orchid","t_fl_chrysanthemum","t_dr_green","t_dr_white","t_dr_red"]];function Tt(i){return _(this,null,function*(){if(!i)return"<svg><defs></defs></svg>";let t=yield H(i),e=t.height/5,s=t.width/9,o=N(i),n=`<svg><defs><image id="${o}" xlink:href="${i}" x="0" y="0" height="${t.height}" width="${t.width}"/>`;for(let[a,h]of V.entries()){let d=a*e;for(let[F,C]of h.entries()){let B=F*s;n+=`<svg preserveAspectRatio="xMidYMid slice" id="${C}" width="75" height="100" viewBox="${B} ${d} ${s} ${e}"><use xlink:href="#${o}"></use></svg>`}}return n+="</defs></svg>",n})}export{W as a,G as b,L as c,jt as d,Et as e,St as f,Tt as g};
